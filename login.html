<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Log in | Root Health</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- You can tweak this later to match your main styling -->
    <link rel="stylesheet" href="/css/styles.css" />
    <style>
      body {
        min-height: 100vh;
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: radial-gradient(circle at top, #1f2937, #020617);
        color: #e5e7eb;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      }
      .card {
        width: 100%;
        max-width: 380px;
        border-radius: 20px;
        padding: 24px 20px;
        background: rgba(15, 23, 42, 0.85);
        border: 1px solid rgba(148, 163, 184, 0.35);
        backdrop-filter: blur(18px);
        box-shadow: 0 18px 45px rgba(0, 0, 0, 0.6);
      }
      .card h1 {
        font-size: 1.25rem;
        margin: 0 0 4px;
        text-align: center;
      }
      .card p.subtitle {
        font-size: 0.75rem;
        color: #9ca3af;
        margin: 0 0 16px;
        text-align: center;
      }
      form {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 4px;
      }
      input[type="email"] {
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: rgba(15, 23, 42, 0.85);
        color: #e5e7eb;
        padding: 8px 12px;
        font-size: 0.85rem;
        outline: none;
      }
      input[type="email"]:focus {
        border-color: #22c55e;
      }
      button {
        border-radius: 999px;
        border: none;
        background: #22c55e;
        color: #020617;
        padding: 8px 12px;
        margin-top: 4px;
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
      }
      button:disabled {
        opacity: 0.6;
        cursor: default;
      }
      .status {
        margin-top: 10px;
        font-size: 0.75rem;
        text-align: center;
      }
      .status.ok {
        color: #6ee7b7;
      }
      .status.error {
        color: #fca5a5;
      }
      .back-link {
        margin-top: 12px;
        font-size: 0.75rem;
        text-align: center;
      }
      .back-link a {
        color: #93c5fd;
        text-decoration: none;
      }
      .back-link a:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>Log in to Root Health</h1>
      <p class="subtitle">
        Enter your email. We&apos;ll send you a magic login link.
      </p>
      <form id="login-form">
        <input
          type="email"
          id="email"
          required
          placeholder="you@example.com"
          autocomplete="email"
        />
        <button type="submit" id="login-button">Send magic link</button>
      </form>
      <div id="status" class="status"></div>
      <div class="back-link">
        <a href="/">‚Üê Back to app</a>
      </div>
    </div>

    <!-- Supabase client via CDN -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
      (function () {
        const { createClient } = supabase;

        // TODO: paste your own values here from Supabase API settings:
        const supabaseUrl = "https://bechmxbywqhsauhctewo.supabase.co";
        const supabaseAnonKey =
          "REPLACE_WITH_YOUR_ANON_KEY";

        const client = createClient(supabaseUrl, supabaseAnonKey);

        const form = document.getElementById("login-form");
        const emailInput = document.getElementById("email");
        const statusEl = document.getElementById("status");
        const button = document.getElementById("login-button");

        form.addEventListener("submit", async function (e) {
          e.preventDefault();
          statusEl.textContent = "";
          statusEl.className = "status";
          button.disabled = true;

          const email = emailInput.value.trim();
          if (!email) {
            statusEl.textContent = "Please enter your email.";
            statusEl.className = "status error";
            button.disabled = false;
            return;
          }

          try {
            const { error } = await client.auth.signInWithOtp({
              email,
              options: {
                emailRedirectTo: window.location.origin + "/",
              },
            });

            if (error) {
              statusEl.textContent = error.message;
              statusEl.className = "status error";
            } else {
              statusEl.textContent =
                "Magic link sent! Check your email to finish logging in.";
              statusEl.className = "status ok";
            }
          } catch (err) {
            statusEl.textContent =
              "Something went wrong sending the link. Please try again.";
            statusEl.className = "status error";
          } finally {
            button.disabled = false;
          }
        });
      })();
    </script>
  </body>
</html>
