<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Root Cause Power - Complete PTSD Support Platform</title>
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content="Root Cause Power">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Root Cause Power">
    <meta name="description" content="AI-powered PTSD support platform combining Lifestyle Medicine and Clinical Hypnotherapy">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#10b981">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="./icons/apple-touch-icon-180x180.svg">
    <link rel="apple-touch-icon" sizes="152x152" href="./icons/apple-touch-icon-152x152.svg">
    <link rel="apple-touch-icon" sizes="120x120" href="./icons/apple-touch-icon-120x120.svg">
    <link rel="apple-touch-icon" sizes="76x76" href="./icons/apple-touch-icon-76x76.svg">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" sizes="32x32" href="./icons/favicon-32x32.svg">
    <link rel="icon" type="image/svg+xml" sizes="16x16" href="./icons/favicon-16x16.svg">
    <link rel="shortcut icon" href="./icons/favicon.ico">
    
    <!-- Stylesheets -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./css/styles.css">
</head>
<body class="bg-gray-50">
    <!-- PWA Installation Banner -->
    <div id="install-banner" class="hidden fixed top-0 left-0 right-0 bg-green-500 text-white p-3 z-50">
        <div class="container mx-auto flex items-center justify-between">
            <div class="flex items-center">
                <i class="fas fa-download mr-2"></i>
                <span>Install Root Cause Power app for better experience!</span>
            </div>
            <div class="flex space-x-2">
                <button id="install-button" class="bg-white text-green-500 px-3 py-1 rounded text-sm font-semibold">Install</button>
                <button id="dismiss-install" class="text-white hover:text-gray-200">‚úï</button>
            </div>
        </div>
    </div>

    <!-- API Status Indicator -->
    <div id="api-status" class="fixed top-4 left-4 z-40 px-3 py-1 rounded-full text-sm font-bold bg-green-500 text-white">
        <span id="api-status-text">AI Connected</span>
    </div>

    <!-- Audio Control -->
    <button onclick="app.stopAllAudio()" id="stop-audio-btn" class="fixed top-4 right-4 z-40 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold hover:bg-red-600 transition-colors" title="Stop All Audio">
        <i class="fas fa-volume-mute"></i> Stop Audio
    </button>

    <!-- Credit Counter -->
    <div id="credit-counter" class="fixed top-16 right-4 z-40 bg-green-500 text-white px-3 py-1 rounded-full text-sm font-bold">
        <span id="credit-count">5/5 Daily</span>
    </div>

    <!-- Voice Credit Counter -->
    <div id="voice-credit-counter" class="fixed top-28 right-4 z-40 bg-purple-500 text-white px-3 py-1 rounded-full text-sm font-bold cursor-pointer hover:bg-purple-600 transition-colors" onclick="app.showVoiceCreditStore()" title="Buy Voice Credits">
        <i class="fas fa-microphone mr-1"></i><span id="voice-credit-count">0</span> Voice
    </div>

    <!-- Navigation -->
    <nav class="bg-gray-800 text-white p-4 fixed w-full top-0 z-30" id="main-nav">
        <div class="container mx-auto flex justify-between items-center">
            <div class="text-2xl font-bold text-green-400 flex items-center">
                <i class="fas fa-heart mr-2"></i>
                Root Cause Power
            </div>
            
            <!-- Mobile Menu Button -->
            <button id="mobile-menu-btn" class="md:hidden text-white focus:outline-none">
                <i class="fas fa-bars text-xl"></i>
            </button>
            
            <!-- Desktop Navigation -->
            <div class="hidden md:flex space-x-6" id="desktop-nav">
                <div class="nav-item px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="home">Home</div>
                <div class="nav-item px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="assessment">Life Analysis</div>
                <div class="nav-item px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="coaches">AI Coaches</div>
                <div class="nav-item px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="nutrition">Nutrition</div>
                <div class="nav-item px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="media-library">Media Library</div>
                <div class="nav-item px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="dashboard">Dashboard</div>
                <div class="nav-item px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="community">Community</div>
                <div class="nav-item px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="ptsd-corner">PTSD Corner</div>
                <div class="nav-item px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="pricing">Pricing</div>
                <div class="nav-item px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="help">Help</div>
            </div>
            
            <button id="login-btn" class="bg-green-500 px-4 py-2 rounded hover:bg-green-600 transition-colors">Login</button>
        </div>
        
        <!-- Mobile Navigation -->
        <div id="mobile-nav" class="hidden md:hidden mt-4 space-y-2">
            <div class="nav-item block px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="home">Home</div>
            <div class="nav-item block px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="assessment">Life Analysis</div>
            <div class="nav-item block px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="coaches">AI Coaches</div>
            <div class="nav-item block px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="nutrition">Nutrition</div>
            <div class="nav-item block px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="media-library">Media Library</div>
            <div class="nav-item block px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="dashboard">Dashboard</div>
            <div class="nav-item block px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="community">Community</div>
            <div class="nav-item block px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="ptsd-corner">PTSD Corner</div>
            <div class="nav-item block px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="pricing">Pricing</div>
            <div class="nav-item block px-3 py-2 rounded cursor-pointer hover:bg-gray-700 transition-colors" data-section="help">Help</div>
        </div>
    </nav>

    <!-- Main App Container -->
    <div id="app-container" class="pt-24 md:pt-28">
        <!-- Home Section -->
        <section id="home" class="section active">
            <div class="gradient-bg text-white py-20">
                <div class="container mx-auto text-center px-4">
                    <div class="mb-6">
                        <i class="fas fa-heart text-6xl mb-4 animate-pulse"></i>
                    </div>
                    <h1 class="text-4xl md:text-5xl font-bold mb-4">Root Cause Power</h1>
                    <p class="text-lg md:text-xl mb-8">Discover the root causes of your health challenges with AI-powered lifestyle medicine</p>
                    <p class="text-base md:text-lg mb-8 opacity-90">Created by David Prince, PhD Candidate in Lifestyle Medicine & Clinical Hypnotherapist (CNHC Registered)</p>
                    <button data-section="assessment" class="cta-button bg-white text-blue-600 px-6 md:px-8 py-3 rounded-lg text-lg font-semibold hover:bg-gray-100 transition-colors shadow-lg">Start Your Life Analysis</button>
                </div>
            </div>

            <div class="container mx-auto py-16 px-4">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold mb-4">Combining Science & Wisdom</h2>
                    <p class="text-lg md:text-xl text-gray-600">Our platform integrates Lifestyle Medicine and Clinical Hypnotherapy for comprehensive wellness</p>
                </div>

                <div class="grid md:grid-cols-3 gap-8 mb-16">
                    <div class="feature-card text-center p-6 bg-white rounded-lg shadow-lg hover:shadow-xl transition-shadow">
                        <i class="fas fa-brain text-4xl text-blue-500 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Lifestyle Medicine</h3>
                        <p class="text-gray-600">Evidence-based approach to preventing and treating chronic diseases through lifestyle interventions</p>
                    </div>
                    <div class="feature-card text-center p-6 bg-white rounded-lg shadow-lg hover:shadow-xl transition-shadow">
                        <i class="fas fa-leaf text-4xl text-green-500 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Clinical Hypnotherapy</h3>
                        <p class="text-gray-600">Professional therapeutic techniques to address subconscious patterns affecting health</p>
                    </div>
                    <div class="feature-card text-center p-6 bg-white rounded-lg shadow-lg hover:shadow-xl transition-shadow">
                        <i class="fas fa-robot text-4xl text-purple-500 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">AI Integration</h3>
                        <p class="text-gray-600">Personalized coaching and recommendations powered by advanced artificial intelligence</p>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white rounded-lg shadow-lg p-8">
                    <h3 class="text-2xl font-bold text-center mb-6">Get Started Now</h3>
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <button data-section="assessment" class="quick-action bg-green-100 hover:bg-green-200 text-green-800 p-4 rounded-lg text-center transition-colors">
                            <i class="fas fa-clipboard-list text-2xl mb-2 block"></i>
                            <span class="font-semibold">Take Assessment</span>
                        </button>
                        <button data-section="ptsd-corner" class="quick-action bg-purple-100 hover:bg-purple-200 text-purple-800 p-4 rounded-lg text-center transition-colors">
                            <i class="fas fa-shield-alt text-2xl mb-2 block"></i>
                            <span class="font-semibold">PTSD Support</span>
                        </button>
                        <button data-section="coaches" class="quick-action bg-blue-100 hover:bg-blue-200 text-blue-800 p-4 rounded-lg text-center transition-colors">
                            <i class="fas fa-user-md text-2xl mb-2 block"></i>
                            <span class="font-semibold">AI Coaches</span>
                        </button>
                        <button data-section="media-library" class="quick-action bg-orange-100 hover:bg-orange-200 text-orange-800 p-4 rounded-lg text-center transition-colors">
                            <i class="fas fa-play-circle text-2xl mb-2 block"></i>
                            <span class="font-semibold">Media Library</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Intelligent Analysis Section -->
        <section id="assessment" class="section hidden">
            <div class="container mx-auto py-8 px-4">
                <!-- Safety & Care Message -->
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 border-l-4 border-purple-500 p-6 mb-8 rounded-lg">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <i class="fas fa-shield-heart text-purple-500 text-2xl"></i>
                        </div>
                        <div class="ml-4">
                            <h4 class="text-lg font-semibold text-purple-800 mb-2">You're in Safe Hands</h4>
                            <p class="text-sm text-purple-700 leading-relaxed">
                                This intelligent analysis is designed by experts in trauma recovery and lifestyle medicine. 
                                <strong>If you're in crisis right now</strong>, please reach out to emergency services or call a crisis helpline immediately. 
                                Your safety and wellbeing are our top priority.
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Welcome Header -->
                <div class="text-center mb-12">
                    <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-purple-500 to-blue-500 rounded-full mb-4">
                        <i class="fas fa-brain text-white text-3xl"></i>
                    </div>
                    <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4">
                        Your Intelligent Life Analysis
                    </h1>
                    <p class="text-xl text-gray-600 mb-3">A personalized journey designed specifically for you</p>
                    <p class="text-lg text-purple-600 font-semibold bg-purple-100 px-6 py-2 rounded-full inline-block">
                        ‚ú® 10 thoughtful steps to understanding your path forward
                    </p>
                </div>

                <!-- Main Analysis Container -->
                <div id="assessment-container" class="max-w-5xl mx-auto">
                    <!-- Progress Section -->
                    <div class="bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg shadow-xl p-6 mb-8 text-white">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold flex items-center">
                                <i class="fas fa-route mr-2"></i>
                                Your Journey Progress
                            </h3>
                            <span id="step-indicator" class="text-sm bg-white bg-opacity-20 px-4 py-2 rounded-full font-semibold">
                                Step <span id="current-step">1</span> of 10
                            </span>
                        </div>
                        <div class="w-full bg-white bg-opacity-20 rounded-full h-4 mb-3">
                            <div id="progress-bar" class="bg-gradient-to-r from-yellow-400 to-green-400 h-4 rounded-full transition-all duration-700 flex items-center justify-end pr-2" style="width: 10%;">
                                <i class="fas fa-star text-white text-xs animate-pulse"></i>
                            </div>
                        </div>
                        <div id="progress-message" class="text-sm opacity-95 italic">
                            üåü Every step brings you closer to understanding yourself better...
                        </div>
                    </div>

                    <!-- AI Analysis Interface -->
                    <div class="bg-white rounded-xl shadow-2xl overflow-hidden border border-gray-100">
                        <!-- AI Avatar Header -->
                        <div class="bg-gradient-to-r from-purple-50 to-blue-50 p-6 border-b border-gray-100">
                            <div class="flex items-center">
                                <div class="w-16 h-16 bg-gradient-to-br from-purple-400 to-blue-500 rounded-full flex items-center justify-center text-white text-2xl mr-4 shadow-lg">
                                    <i class="fas fa-user-md"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-2xl font-bold text-gray-800">Coach Sarah</h3>
                                    <p class="text-gray-600 mb-1">Your AI Wellness Analyst</p>
                                    <div class="flex items-center text-sm text-green-600">
                                        <i class="fas fa-circle text-xs mr-2 animate-pulse"></i>
                                        Active and listening
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm text-gray-500">Powered by</div>
                                    <div class="text-lg font-bold text-purple-600">Advanced AI</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Analysis Content Area -->
                        <div class="p-8">
                            <div id="assessment-questions" class="min-h-64">
                                <!-- Dynamic content will be inserted here -->
                            </div>
                        </div>
                        
                        <!-- Navigation Footer -->
                        <div class="bg-gray-50 p-6 flex justify-between items-center border-t border-gray-100">
                            <button id="prev-btn" class="bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 transition-all duration-200 disabled:opacity-50 flex items-center" disabled>
                                <i class="fas fa-chevron-left mr-2"></i>
                                Previous
                            </button>
                            <div class="text-center">
                                <div id="step-info" class="text-sm text-gray-500 mb-1">Moving at your own pace</div>
                                <div class="text-xs text-gray-400">Take your time - there's no rush</div>
                            </div>
                            <button id="next-btn" class="bg-gradient-to-r from-purple-500 to-blue-500 text-white px-8 py-3 rounded-lg hover:from-purple-600 hover:to-blue-600 transition-all duration-200 flex items-center shadow-lg">
                                Continue
                                <i class="fas fa-chevron-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Encouragement & Support -->
                    <div class="mt-8 grid md:grid-cols-2 gap-6">
                        <div class="bg-green-50 p-6 rounded-lg border border-green-200">
                            <div class="flex items-center mb-3">
                                <i class="fas fa-heart text-red-500 text-xl mr-3"></i>
                                <h4 class="font-semibold text-green-800">You're Not Alone</h4>
                            </div>
                            <p class="text-green-700 text-sm">
                                Every answer helps us understand how to support you better. You're taking a courageous step toward healing and growth.
                            </p>
                        </div>
                        <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                            <div class="flex items-center mb-3">
                                <i class="fas fa-shield-alt text-blue-500 text-xl mr-3"></i>
                                <h4 class="font-semibold text-blue-800">Safe & Confidential</h4>
                            </div>
                            <p class="text-blue-700 text-sm">
                                Your responses are completely private and secure. We use advanced encryption to protect your personal information.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- AI Coaches Section -->
        <section id="coaches" class="section hidden">
            <div class="container mx-auto py-8 px-4">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-8">Your AI Health Specialists</h2>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="coach-card text-white p-6 rounded-lg shadow-lg cursor-pointer hover:shadow-xl transition-all transform hover:scale-105" data-coach="nutrition">
                        <i class="fas fa-apple-alt text-4xl mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Nutrition Coach</h3>
                        <p>Personalized meal plans and nutritional guidance based on your assessment results</p>
                    </div>
                    <div class="coach-card text-white p-6 rounded-lg shadow-lg cursor-pointer hover:shadow-xl transition-all transform hover:scale-105" data-coach="sleep">
                        <i class="fas fa-bed text-4xl mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Sleep Specialist</h3>
                        <p>Optimize your sleep patterns and recovery for better health outcomes</p>
                    </div>
                    <div class="coach-card text-white p-6 rounded-lg shadow-lg cursor-pointer hover:shadow-xl transition-all transform hover:scale-105" data-coach="stress">
                        <i class="fas fa-spa text-4xl mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Stress Management</h3>
                        <p>Techniques and strategies to manage stress and improve mental wellbeing</p>
                    </div>
                    <div class="coach-card text-white p-6 rounded-lg shadow-lg cursor-pointer hover:shadow-xl transition-all transform hover:scale-105" data-coach="fitness">
                        <i class="fas fa-dumbbell text-4xl mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Fitness Coach</h3>
                        <p>Customized exercise programs tailored to your fitness level and goals</p>
                    </div>
                    <div class="coach-card text-white p-6 rounded-lg shadow-lg cursor-pointer hover:shadow-xl transition-all transform hover:scale-105" data-coach="supplements">
                        <i class="fas fa-pills text-4xl mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Supplement Advisor</h3>
                        <p>Evidence-based supplement recommendations for your specific health needs</p>
                    </div>
                    <div class="trauma-safe text-white p-6 rounded-lg shadow-lg cursor-pointer hover:shadow-xl transition-all transform hover:scale-105" data-coach="ptsd">
                        <i class="fas fa-heart text-4xl mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">PTSD Specialist</h3>
                        <p>Specialized support for PTSD, CPTSD, and trauma recovery with 24/7 availability</p>
                    </div>
                    <div class="bg-gradient-to-br from-purple-600 to-blue-600 text-white p-6 rounded-lg shadow-lg cursor-pointer hover:shadow-xl transition-all transform hover:scale-105 relative" onclick="app.openVoiceAI()">
                        <div class="absolute top-2 right-2 bg-yellow-400 text-black px-2 py-1 rounded-full text-xs font-bold">NEW!</div>
                        <i class="fas fa-microphone text-4xl mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">üé§ Voice AI Coach</h3>
                        <p>Emotionally intelligent voice coaching powered by advanced AI - talk naturally and get empathetic responses</p>
                        <div class="mt-3 text-sm bg-white bg-opacity-20 p-2 rounded">
                            <i class="fas fa-bolt mr-1"></i>Uses voice credits ‚Ä¢ Natural conversation
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Nutrition Section -->
        <section id="nutrition" class="section hidden">
            <div class="container mx-auto py-8 px-4">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-8">Nutrition & Wellness</h2>
                
                <div class="grid lg:grid-cols-3 gap-8 mb-8">
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-2xl font-bold mb-4">ü•ó Food Database Search</h3>
                        <div class="space-y-4">
                            <input type="text" id="food-search" placeholder="Search any food (e.g., 'salmon with quinoa')" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                            <button id="search-food-btn" class="w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 transition-colors">
                                <i class="fas fa-search mr-2"></i>Search Nutrition
                            </button>
                        </div>
                        <div id="food-results" class="mt-4"></div>
                    </div>

                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-2xl font-bold mb-4">üî¨ Advanced Nutrition Analysis</h3>
                        <div class="space-y-4">
                            <p class="text-gray-600">Get personalized nutrition recommendations based on your assessment and goals.</p>
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="font-bold mb-2">üìã Assessment-Based Nutrition</h4>
                                <p class="text-sm text-gray-700">Your nutrition plan is automatically personalized based on your trauma history, medical conditions, and health goals from your assessment.</p>
                            </div>
                            <button onclick="app.openCoachModal('nutrition')" class="w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 transition-colors">
                                <i class="fas fa-leaf mr-2"></i>Get Personalized Nutrition Plan
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-2xl font-bold mb-4">ü§ñ AI Meal Planner</h3>
                        <div class="space-y-4">
                            <p class="text-gray-600">Tell me your goals, and I'll create a personalized meal plan!</p>
                            <input type="text" id="meal-goal" placeholder="e.g., 'Support my PTSD recovery with anti-inflammatory foods'" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <button id="start-meal-planning-btn" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors">
                                <i class="fas fa-utensils mr-2"></i>Start Meal Planning
                            </button>
                        </div>
                        <div id="meal-planning-chat" class="mt-4 hidden">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-medium text-gray-700">Nutrition Coach Chat</h4>
                                <button onclick="document.getElementById('meal-planning-chat').classList.add('hidden')" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div id="meal-chat-messages" class="bg-gray-50 p-4 rounded-lg h-48 max-h-64 overflow-y-auto mb-4 border border-gray-200"></div>
                            <div class="space-y-2">
                                <div class="flex space-x-2">
                                    <input type="text" id="meal-user-input" placeholder="Type your message..." class="flex-1 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <button id="send-meal-btn" class="bg-blue-500 text-white px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors md:hidden">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                                <div class="text-xs text-gray-500 text-center">
                                    <span class="hidden md:inline">Press Enter to send</span>
                                    <span class="md:hidden">Tap send button or press Enter</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Nutrition Journal Section -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                    <h3 class="text-2xl font-bold mb-4">üìä My Nutrition Journal</h3>
                    <div id="nutrition-journal" class="space-y-4">
                        <div class="bg-gray-50 p-4 rounded-lg text-center">
                            <i class="fas fa-journal-whills text-3xl text-gray-400 mb-2"></i>
                            <p class="text-gray-600">Your nutrition analyses and meal plans will appear here</p>
                            <button onclick="app.loadNutritionJournal()" class="mt-2 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition-colors">
                                <i class="fas fa-sync-alt mr-2"></i>Refresh Journal
                            </button>
                        </div>
                    </div>
                </div>

                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h4 class="text-lg font-bold mb-3">üß† Gut-Brain Connection</h4>
                        <p class="text-gray-600 mb-3">Your gut health directly impacts mental wellbeing and trauma recovery.</p>
                        <ul class="text-sm space-y-1">
                            <li>‚Ä¢ 90% of serotonin is made in the gut</li>
                            <li>‚Ä¢ Probiotics can reduce anxiety</li>
                            <li>‚Ä¢ Anti-inflammatory foods support mood</li>
                            <li>‚Ä¢ Omega-3s aid PTSD recovery</li>
                        </ul>
                        <div class="mt-4">
                            <button onclick="app.openCoachModal('nutrition')" class="text-green-600 hover:text-green-800 font-semibold text-sm">
                                üí¨ Ask Nutrition Coach ‚Üí
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h4 class="text-lg font-bold mb-3">‚ö° Energy Boosting Foods</h4>
                        <div class="space-y-2">
                            <div class="food-card p-2 bg-green-50 rounded hover:bg-green-100 transition-colors cursor-pointer" onclick="app.searchSpecificFood('quinoa')">
                                <strong>Quinoa</strong> - Complete protein, sustained energy
                            </div>
                            <div class="food-card p-2 bg-blue-50 rounded hover:bg-blue-100 transition-colors cursor-pointer" onclick="app.searchSpecificFood('blueberries')">
                                <strong>Blueberries</strong> - Antioxidants, brain health
                            </div>
                            <div class="food-card p-2 bg-orange-50 rounded hover:bg-orange-100 transition-colors cursor-pointer" onclick="app.searchSpecificFood('sweet potato')">
                                <strong>Sweet Potato</strong> - Complex carbs, B vitamins
                            </div>
                        </div>
                        <div class="mt-4">
                            <button onclick="document.getElementById('food-search').focus()" class="text-green-600 hover:text-green-800 font-semibold text-sm">
                                üîç Search More Foods ‚Üí
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h4 class="text-lg font-bold mb-3">üåø Trauma Recovery Nutrition</h4>
                        <ul class="text-sm space-y-2">
                            <li><span class="font-semibold">Magnesium:</span> Calms nervous system</li>
                            <li><span class="font-semibold">Omega-3:</span> Reduces inflammation</li>
                            <li><span class="font-semibold">B-Complex:</span> Supports stress response</li>
                            <li><span class="font-semibold">Vitamin D:</span> Mood regulation</li>
                            <li><span class="font-semibold">Probiotics:</span> Gut-brain health</li>
                        </ul>
                        <div class="mt-4">
                            <button onclick="app.searchSpecificFood('salmon')" class="text-purple-600 hover:text-purple-800 font-semibold text-sm">
                                üêü See Salmon Benefits ‚Üí
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Media Library Section -->
        <section id="media-library" class="section hidden">
            <div class="container mx-auto py-8 px-4">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-8">Therapeutic Media Library</h2>
                
                <div class="mb-8">
                    <div class="flex flex-wrap justify-center gap-2 mb-6">
                        <button class="media-filter-btn bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition-colors" data-filter="all">All</button>
                        <button class="media-filter-btn bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 transition-colors" data-filter="trauma">Trauma Recovery</button>
                        <button class="media-filter-btn bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 transition-colors" data-filter="hypnotherapy">Hypnotherapy</button>
                        <button class="media-filter-btn bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 transition-colors" data-filter="education">Education</button>
                        <button class="media-filter-btn bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 transition-colors" data-filter="meditation">Meditation</button>
                    </div>
                </div>

                <div id="video-grid" class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8"></div>

                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-2xl font-bold mb-4">ü§ñ Ask Me Anything - Educational AI</h3>
                    <div class="space-y-4">
                        <p class="text-gray-600">Ask questions about trauma recovery, PTSD, therapy techniques, or any educational content.</p>
                        <input type="text" id="education-question" placeholder="e.g., 'Explain EMDR therapy for my specific trauma type'" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                        <button id="ask-educational-ai-btn" class="bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition-colors">Ask AI</button>
                    </div>
                    <div id="educational-response" class="mt-4 p-4 bg-gray-50 rounded-lg hidden"></div>
                </div>
            </div>
        </section>

        <!-- Inspirational Dashboard Section -->
        <section id="dashboard" class="section hidden">
            <!-- Hero Welcome Section -->
            <div class="bg-gradient-to-br from-purple-600 via-blue-600 to-green-500 text-white relative overflow-hidden">
                <div class="absolute inset-0 bg-black bg-opacity-20"></div>
                <div class="relative container mx-auto py-16 px-4 text-center">
                    <div class="inline-flex items-center justify-center w-24 h-24 bg-white bg-opacity-20 rounded-full mb-6 animate-pulse">
                        <i class="fas fa-star text-4xl text-yellow-300"></i>
                    </div>
                    <h1 class="text-4xl md:text-6xl font-bold mb-4" id="dashboard-greeting">Welcome Back, Champion! üåü</h1>
                    <p class="text-xl md:text-2xl mb-6 opacity-95" id="motivational-message">You're making incredible progress on your healing journey</p>
                    <div class="bg-white bg-opacity-20 rounded-lg p-6 backdrop-blur-sm max-w-2xl mx-auto">
                        <div class="flex items-center justify-center space-x-6">
                            <div class="text-center">
                                <div class="text-3xl font-bold" id="days-since-start">12</div>
                                <div class="text-sm opacity-90">Days Strong</div>
                            </div>
                            <div class="w-px h-12 bg-white bg-opacity-30"></div>
                            <div class="text-center">
                                <div class="text-3xl font-bold" id="total-progress">78%</div>
                                <div class="text-sm opacity-90">Journey Complete</div>
                            </div>
                            <div class="w-px h-12 bg-white bg-opacity-30"></div>
                            <div class="text-center">
                                <div class="text-3xl font-bold" id="achievements-count">5</div>
                                <div class="text-sm opacity-90">Achievements</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container mx-auto py-8 px-4">
                <!-- Recovery Prescription Display -->
                <div id="prescription-preview" class="mb-8 hidden">
                    <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl shadow-lg border border-green-200 p-6">
                        <div class="flex items-start">
                            <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center text-white mr-4">
                                <i class="fas fa-prescription text-xl"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 mb-2">Your Recovery Prescription is Ready! üéÜ</h3>
                                <p class="text-gray-600 mb-3">Coach Sarah has created your personalized healing roadmap based on your analysis.</p>
                                <button onclick="app.showRecoveryPrescription()" class="bg-gradient-to-r from-green-500 to-blue-500 text-white px-6 py-2 rounded-lg hover:from-green-600 hover:to-blue-600 transition-all duration-200">
                                    <i class="fas fa-eye mr-2"></i>View My Prescription
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Achievement Badges -->
                <div class="mb-8">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-3xl font-bold text-gray-800">
                            <i class="fas fa-trophy text-yellow-500 mr-3"></i>
                            Your Achievements
                        </h2>
                        <div class="text-sm text-gray-600">
                            üèÜ Level <span id="user-level" class="font-bold text-purple-600">3</span> Healer
                        </div>
                    </div>
                    <div class="grid md:grid-cols-2 lg:grid-cols-5 gap-4" id="achievement-badges">
                        <div class="achievement-badge earned bg-gradient-to-br from-purple-400 to-purple-600 text-white p-4 rounded-xl text-center shadow-lg transform hover:scale-105 transition-transform duration-200">
                            <i class="fas fa-brain text-3xl mb-2"></i>
                            <div class="font-bold text-sm">Analysis Complete</div>
                            <div class="text-xs opacity-90">Took the first step</div>
                        </div>
                        <div class="achievement-badge earned bg-gradient-to-br from-green-400 to-green-600 text-white p-4 rounded-xl text-center shadow-lg transform hover:scale-105 transition-transform duration-200">
                            <i class="fas fa-heart text-3xl mb-2"></i>
                            <div class="font-bold text-sm">Self-Love Journey</div>
                            <div class="text-xs opacity-90">7 days of progress</div>
                        </div>
                        <div class="achievement-badge earned bg-gradient-to-br from-blue-400 to-blue-600 text-white p-4 rounded-xl text-center shadow-lg transform hover:scale-105 transition-transform duration-200">
                            <i class="fas fa-moon text-3xl mb-2"></i>
                            <div class="font-bold text-sm">Sleep Champion</div>
                            <div class="text-xs opacity-90">Improved sleep</div>
                        </div>
                        <div class="achievement-badge locked bg-gray-300 text-gray-600 p-4 rounded-xl text-center shadow-lg">
                            <i class="fas fa-star text-3xl mb-2"></i>
                            <div class="font-bold text-sm">Milestone Master</div>
                            <div class="text-xs opacity-75">30 days strong</div>
                        </div>
                        <div class="achievement-badge locked bg-gray-300 text-gray-600 p-4 rounded-xl text-center shadow-lg">
                            <i class="fas fa-crown text-3xl mb-2"></i>
                            <div class="font-bold text-sm">Wellness Warrior</div>
                            <div class="text-xs opacity-75">Complete journey</div>
                        </div>
                    </div>
                </div>

                <!-- Progress Visualization -->
                <div class="grid lg:grid-cols-3 gap-8 mb-8">
                    <!-- Healing Progress Circle -->
                    <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">Healing Progress</h3>
                        <div class="relative inline-block">
                            <div class="w-32 h-32 mx-auto">
                                <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                                    <circle cx="50" cy="50" r="45" stroke="#e5e7eb" stroke-width="8" fill="none"></circle>
                                    <circle cx="50" cy="50" r="45" stroke="url(#progressGradient)" stroke-width="8" fill="none" 
                                            stroke-dasharray="283" stroke-dashoffset="85" class="transition-all duration-1000 ease-out">
                                    </circle>
                                    <defs>
                                        <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                            <stop offset="0%" stop-color="#10b981" />
                                            <stop offset="100%" stop-color="#3b82f6" />
                                        </linearGradient>
                                    </defs>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-gray-800" id="overall-progress">78%</div>
                                        <div class="text-xs text-gray-600">Complete</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600 mt-4">You're doing amazingly well! üéÜ</p>
                    </div>

                    <!-- Mood Tracker -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4 text-gray-800 flex items-center">
                            <i class="fas fa-smile text-yellow-500 mr-2"></i>
                            Mood Journey
                        </h3>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">This Week</span>
                                <div class="flex space-x-1">
                                    <i class="fas fa-smile text-green-500"></i>
                                    <i class="fas fa-smile text-green-500"></i>
                                    <i class="fas fa-meh text-yellow-500"></i>
                                    <i class="fas fa-smile text-green-500"></i>
                                    <i class="fas fa-laugh text-green-600"></i>
                                </div>
                            </div>
                            <div class="bg-gradient-to-r from-yellow-100 to-green-100 p-3 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700">Overall Trend</span>
                                    <div class="flex items-center text-green-600">
                                        <i class="fas fa-arrow-up mr-1"></i>
                                        <span class="font-bold">Improving!</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button onclick="app.logMood()" class="w-full mt-4 bg-gradient-to-r from-yellow-400 to-orange-500 text-white py-2 px-4 rounded-lg hover:from-yellow-500 hover:to-orange-600 transition-all duration-200">
                            Log Today's Mood
                        </button>
                    </div>

                    <!-- Daily Wins -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4 text-gray-800 flex items-center">
                            <i class="fas fa-star text-purple-500 mr-2"></i>
                            Today's Wins
                        </h3>
                        <div class="space-y-3" id="daily-wins">
                            <div class="flex items-center p-2 bg-purple-50 rounded-lg">
                                <i class="fas fa-check-circle text-purple-500 mr-3"></i>
                                <span class="text-sm text-gray-700">Completed morning meditation</span>
                            </div>
                            <div class="flex items-center p-2 bg-green-50 rounded-lg">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                <span class="text-sm text-gray-700">Healthy breakfast choice</span>
                            </div>
                            <div class="flex items-center p-2 bg-blue-50 rounded-lg">
                                <i class="fas fa-check-circle text-blue-500 mr-3"></i>
                                <span class="text-sm text-gray-700">Practiced deep breathing</span>
                            </div>
                        </div>
                        <button onclick="app.addDailyWin()" class="w-full mt-4 bg-gradient-to-r from-purple-400 to-pink-500 text-white py-2 px-4 rounded-lg hover:from-purple-500 hover:to-pink-600 transition-all duration-200">
                            <i class="fas fa-plus mr-2"></i>Add Today's Win
                        </button>
                    </div>
                </div>

                <!-- üåü FEATURED: Live Wellness Sessions -->
                <div class="bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 rounded-2xl shadow-2xl p-8 mb-6 text-white relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-40 h-40 bg-white bg-opacity-10 rounded-full -mr-20 -mt-20"></div>
                    <div class="absolute bottom-0 left-0 w-32 h-32 bg-white bg-opacity-10 rounded-full -ml-16 -mb-16"></div>
                    
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <div class="flex items-center mb-3">
                                    <i class="fas fa-video text-4xl mr-4 text-yellow-300"></i>
                                    <div>
                                        <h2 class="text-3xl font-bold mb-1">üéØ Complete Wellness Sessions</h2>
                                        <p class="text-blue-100">Expert practitioners covering PTSD, nutrition, hypnotherapy & more</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-6 text-sm">
                                    <div class="flex items-center">
                                        <i class="fas fa-brain text-pink-300 mr-2"></i>
                                        <span>PTSD & Trauma Therapy</span>
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-apple-alt text-green-300 mr-2"></i>
                                        <span>Functional Nutrition</span>
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-leaf text-blue-300 mr-2"></i>
                                        <span>Clinical Hypnotherapy</span>
                                    </div>
                                </div>
                            </div>
                            <button onclick="app.openSessionBooking()" 
                                    class="bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg hover:bg-blue-50 transition-all duration-300 shadow-lg transform hover:scale-105">
                                <i class="fas fa-calendar-plus mr-3"></i>Book Session
                            </button>
                        </div>
                        
                        <div class="grid md:grid-cols-4 gap-4 text-center">
                            <div class="bg-white bg-opacity-10 rounded-lg p-4">
                                <i class="fas fa-heart text-2xl mb-2 text-pink-300"></i>
                                <div class="font-semibold">Trauma-Informed</div>
                                <div class="text-xs opacity-90">EMDR & Somatic Therapy</div>
                            </div>
                            <div class="bg-white bg-opacity-10 rounded-lg p-4">
                                <i class="fas fa-dna text-2xl mb-2 text-green-300"></i>
                                <div class="font-semibold">Personalized</div>
                                <div class="text-xs opacity-90">AI-Prepared Sessions</div>
                            </div>
                            <div class="bg-white bg-opacity-10 rounded-lg p-4">
                                <i class="fas fa-user-md text-2xl mb-2 text-blue-300"></i>
                                <div class="font-semibold">Expert Care</div>
                                <div class="text-xs opacity-90">Licensed Practitioners</div>
                            </div>
                            <div class="bg-white bg-opacity-10 rounded-lg p-4">
                                <i class="fas fa-lock text-2xl mb-2 text-yellow-300"></i>
                                <div class="font-semibold">Private & Secure</div>
                                <div class="text-xs opacity-90">HIPAA Compliant</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- üéâ FEATURED: Revolutionary Voice Coach -->
                <div class="bg-gradient-to-r from-purple-600 via-pink-600 to-indigo-600 rounded-2xl shadow-2xl p-8 mb-8 text-white relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-white bg-opacity-10 rounded-full -mr-16 -mt-16"></div>
                    <div class="absolute bottom-0 left-0 w-24 h-24 bg-white bg-opacity-10 rounded-full -ml-12 -mb-12"></div>
                    
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <div class="flex items-center mb-3">
                                    <i class="fas fa-microphone-alt text-4xl mr-4 text-yellow-300"></i>
                                    <div>
                                        <h2 class="text-3xl font-bold mb-1">üß† Revolutionary PTSD Voice Coach</h2>
                                        <p class="text-purple-100">World's first emotionally intelligent voice companion</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-6 text-sm">
                                    <div class="flex items-center">
                                        <i class="fas fa-check-circle text-green-300 mr-2"></i>
                                        <span>Crisis Detection Active</span>
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-heart text-pink-300 mr-2"></i>
                                        <span>Trauma-Informed AI</span>
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-comments text-blue-300 mr-2"></i>
                                        <span>True Voice Conversation</span>
                                    </div>
                                </div>
                            </div>
                            <button onclick="app.openVoiceCoach()" 
                                    class="bg-white text-purple-600 px-8 py-4 rounded-xl font-bold text-lg hover:bg-purple-50 transition-all duration-300 shadow-lg transform hover:scale-105">
                                <i class="fas fa-microphone mr-3"></i>Start Voice Chat
                            </button>
                        </div>
                        
                        <div class="grid md:grid-cols-4 gap-4 text-center">
                            <div class="bg-white bg-opacity-10 rounded-lg p-4">
                                <i class="fas fa-brain text-2xl mb-2 text-yellow-300"></i>
                                <div class="font-semibold">AI Empathy</div>
                                <div class="text-xs opacity-90">Emotional Intelligence</div>
                            </div>
                            <div class="bg-white bg-opacity-10 rounded-lg p-4">
                                <i class="fas fa-shield-alt text-2xl mb-2 text-green-300"></i>
                                <div class="font-semibold">Crisis Support</div>
                                <div class="text-xs opacity-90">24/7 Monitoring</div>
                            </div>
                            <div class="bg-white bg-opacity-10 rounded-lg p-4">
                                <i class="fas fa-leaf text-2xl mb-2 text-blue-300"></i>
                                <div class="font-semibold">Grounding</div>
                                <div class="text-xs opacity-90">Voice-Activated</div>
                            </div>
                            <div class="bg-white bg-opacity-10 rounded-lg p-4">
                                <i class="fas fa-clock text-2xl mb-2 text-pink-300"></i>
                                <div class="font-semibold">Always Here</div>
                                <div class="text-xs opacity-90">24/7 Available</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Health Metrics with Visual Appeal -->
                <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">
                        <i class="fas fa-chart-line text-blue-500 mr-3"></i>
                        Your Health Transformation
                    </h2>
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="health-metric bg-gradient-to-br from-green-400 to-green-600 text-white p-6 rounded-xl shadow-lg transform hover:scale-105 transition-transform duration-200">
                            <div class="flex items-center justify-between mb-3">
                                <i class="fas fa-heart text-3xl"></i>
                                <div class="text-right">
                                    <div class="text-2xl font-bold" id="wellness-score">8.2</div>
                                    <div class="text-xs opacity-90">/10</div>
                                </div>
                            </div>
                            <h3 class="text-lg font-bold mb-1">Wellness Score</h3>
                            <div class="text-sm opacity-90 flex items-center">
                                <i class="fas fa-arrow-up mr-1"></i>
                                +2.1 this week
                            </div>
                        </div>

                        <div class="health-metric bg-gradient-to-br from-blue-400 to-blue-600 text-white p-6 rounded-xl shadow-lg transform hover:scale-105 transition-transform duration-200">
                            <div class="flex items-center justify-between mb-3">
                                <i class="fas fa-bed text-3xl"></i>
                                <div class="text-right">
                                    <div class="text-2xl font-bold" id="sleep-quality">7.8</div>
                                    <div class="text-xs opacity-90">/10</div>
                                </div>
                            </div>
                            <h3 class="text-lg font-bold mb-1">Sleep Quality</h3>
                            <div class="text-sm opacity-90 flex items-center">
                                <i class="fas fa-arrow-up mr-1"></i>
                                Improving steadily
                            </div>
                        </div>

                        <div class="health-metric bg-gradient-to-br from-purple-400 to-purple-600 text-white p-6 rounded-xl shadow-lg transform hover:scale-105 transition-transform duration-200">
                            <div class="flex items-center justify-between mb-3">
                                <i class="fas fa-brain text-3xl"></i>
                                <div class="text-right">
                                    <div class="text-2xl font-bold" id="mental-clarity">Strong</div>
                                </div>
                            </div>
                            <h3 class="text-lg font-bold mb-1">Mental Clarity</h3>
                            <div class="text-sm opacity-90 flex items-center">
                                <i class="fas fa-sparkles mr-1"></i>
                                Excellent progress
                            </div>
                        </div>

                        <div class="health-metric bg-gradient-to-br from-orange-400 to-orange-600 text-white p-6 rounded-xl shadow-lg transform hover:scale-105 transition-transform duration-200">
                            <div class="flex items-center justify-between mb-3">
                                <i class="fas fa-utensils text-3xl"></i>
                                <div class="text-right">
                                    <div class="text-2xl font-bold" id="nutrition-score-dash">92%</div>
                                </div>
                            </div>
                            <h3 class="text-lg font-bold mb-1">Nutrition</h3>
                            <div class="text-sm opacity-90 flex items-center">
                                <i class="fas fa-leaf mr-1"></i>
                                Excellent choices
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Center -->
                <div class="grid lg:grid-cols-2 gap-8 mb-8">
                    <!-- Quick Actions -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">
                            <i class="fas fa-bolt text-yellow-500 mr-3"></i>
                            Quick Actions
                        </h3>
                        <div class="grid grid-cols-2 lg:grid-cols-3 gap-4">
                            <!-- üéâ REVOLUTIONARY VOICE COACH -->
                            <button onclick="app.openVoiceCoach()" class="quick-action-btn bg-gradient-to-br from-purple-500 to-pink-500 text-white p-4 rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all duration-200 text-center relative shadow-xl">
                                <div class="absolute -top-2 -right-2 bg-green-400 text-green-900 text-xs font-bold px-2 py-1 rounded-full animate-pulse">
                                    ‚úÖ VOICE!
                                </div>
                                <i class="fas fa-microphone-alt text-2xl mb-2 block"></i>
                                <div class="font-semibold text-sm">üéôÔ∏è Voice Coach</div>
                                <div class="text-xs opacity-90">Speak & Listen</div>
                            </button>
                            
                            <!-- üåü NEW: LIVE SESSIONS -->
                            <button onclick="app.openSessionBooking()" class="quick-action-btn bg-gradient-to-br from-blue-500 to-indigo-600 text-white p-4 rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 text-center relative shadow-xl">
                                <div class="absolute -top-2 -right-2 bg-orange-400 text-orange-900 text-xs font-bold px-2 py-1 rounded-full animate-pulse">
                                    NEW!
                                </div>
                                <i class="fas fa-video text-2xl mb-2 block"></i>
                                <div class="font-semibold text-sm">üìπ Live Sessions</div>
                                <div class="text-xs opacity-90">Book 1-on-1</div>
                            </button>
                            
                            <button id="quick-checkin-btn" class="quick-action-btn bg-gradient-to-br from-green-400 to-green-600 text-white p-4 rounded-lg hover:from-green-500 hover:to-green-700 transition-all duration-200 text-center">
                                <i class="fas fa-comments text-2xl mb-2 block"></i>
                                <div class="font-semibold text-sm">Quick AI Chat</div>
                            </button>
                            <button data-section="coaches" class="quick-action-btn bg-gradient-to-br from-purple-400 to-purple-600 text-white p-4 rounded-lg hover:from-purple-500 hover:to-purple-700 transition-all duration-200 text-center">
                                <i class="fas fa-user-md text-2xl mb-2 block"></i>
                                <div class="font-semibold text-sm">Meet Coaches</div>
                            </button>
                            <button data-section="ptsd-corner" class="quick-action-btn bg-gradient-to-br from-pink-400 to-pink-600 text-white p-4 rounded-lg hover:from-pink-500 hover:to-pink-700 transition-all duration-200 text-center">
                                <i class="fas fa-heart text-2xl mb-2 block"></i>
                                <div class="font-semibold text-sm">PTSD Support</div>
                            </button>
                            
                            <!-- Schedule Support -->
                            <button onclick="app.scheduleCheckin()" class="quick-action-btn bg-gradient-to-br from-teal-400 to-teal-600 text-white p-4 rounded-lg hover:from-teal-500 hover:to-teal-700 transition-all duration-200 text-center">
                                <i class="fas fa-calendar-check text-2xl mb-2 block"></i>
                                <div class="font-semibold text-sm">Schedule Support</div>
                                <div class="text-xs opacity-90">AI & Live Options</div>
                            </button>
                        </div>
                    </div>

                    <!-- AI Support Status -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">
                            <i class="fas fa-robot text-green-500 mr-3"></i>
                            Your AI Support Team
                        </h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-4 bg-gradient-to-r from-green-50 to-green-100 rounded-lg border border-green-200">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white mr-3">
                                        <i class="fas fa-user-md"></i>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-gray-800">Coach Sarah</div>
                                        <div class="text-sm text-gray-600">Wellness Analyst</div>
                                    </div>
                                </div>
                                <div class="flex items-center text-green-600">
                                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse mr-2"></div>
                                    <span class="text-sm font-medium">Active</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg border border-blue-200">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white mr-3">
                                        <i class="fas fa-apple-alt"></i>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-gray-800">Nutrition Coach</div>
                                        <div class="text-sm text-gray-600">Meal Planning</div>
                                    </div>
                                </div>
                                <div class="flex items-center text-blue-600">
                                    <div class="w-3 h-3 bg-blue-500 rounded-full animate-pulse mr-2"></div>
                                    <span class="text-sm font-medium">Ready</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between p-4 bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg border border-purple-200">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center text-white mr-3">
                                        <i class="fas fa-shield-alt"></i>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-gray-800">Crisis Support</div>
                                        <div class="text-sm text-gray-600">24/7 Protection</div>
                                    </div>
                                </div>
                                <div class="flex items-center text-purple-600">
                                    <div class="w-3 h-3 bg-purple-500 rounded-full animate-pulse mr-2"></div>
                                    <span class="text-sm font-medium">Monitoring</span>
                                </div>
                            </div>
                            <!-- üéâ REVOLUTIONARY VOICE COACH -->
                            <div class="flex items-center justify-between p-4 bg-gradient-to-r from-red-50 to-orange-50 rounded-lg border-2 border-red-200 shadow-lg relative">
                                <div class="absolute -top-2 -right-2 bg-yellow-400 text-red-800 text-xs font-bold px-2 py-1 rounded-full animate-pulse">
                                    üî• WORLD'S FIRST
                                </div>
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-gradient-to-br from-red-500 to-orange-500 rounded-full flex items-center justify-center text-white mr-3">
                                        <i class="fas fa-microphone"></i>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-gray-800">üß† Empathic Voice Coach</div>
                                        <div class="text-sm text-gray-600">Emotionally Intelligent AI</div>
                                    </div>
                                </div>
                                <div class="flex items-center text-red-600">
                                    <div class="w-3 h-3 bg-red-500 rounded-full animate-pulse mr-2"></div>
                                    <span class="text-sm font-medium">REVOLUTIONARY</span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-gray-50 rounded-lg text-center">
                            <p class="text-xs text-gray-600">Last sync: <span id="last-ai-sync-time" class="font-medium">Just now</span></p>
                        </div>
                    </div>
                </div>

                <!-- Inspirational Quote Section -->
                <div class="bg-gradient-to-r from-indigo-500 via-purple-600 to-pink-500 rounded-xl shadow-xl p-8 text-white text-center">
                    <div class="max-w-3xl mx-auto">
                        <i class="fas fa-quote-left text-3xl opacity-60 mb-4"></i>
                        <p class="text-xl md:text-2xl font-medium mb-4" id="daily-inspiration">
                            "You are braver than you believe, stronger than you seem, and more loved than you know."
                        </p>
                        <p class="text-sm opacity-80">Today's inspiration ‚Ä¢ Your journey matters</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Community Section -->
        <section id="community" class="section hidden">
            <div class="container mx-auto py-8 px-4">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-8">Community Support</h2>
                <div class="grid lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-2xl font-bold mb-4">Support Groups</h3>
                        <div class="space-y-4">
                            <div class="border-l-4 border-green-500 pl-4">
                                <h4 class="font-bold">Nutrition Support</h4>
                                <p class="text-gray-600">Share recipes and nutritional tips with fellow members</p>
                                <div class="flex items-center mt-2 text-sm text-gray-500">
                                    <i class="fas fa-users mr-1"></i>
                                    <span>247 members</span>
                                    <span class="mx-2">‚Ä¢</span>
                                    <span>15 posts today</span>
                                </div>
                            </div>
                            <div class="border-l-4 border-purple-500 pl-4">
                                <h4 class="font-bold">PTSD Recovery</h4>
                                <p class="text-gray-600">Safe space for trauma survivors to connect and heal together</p>
                                <div class="flex items-center mt-2 text-sm text-gray-500">
                                    <i class="fas fa-users mr-1"></i>
                                    <span>189 members</span>
                                    <span class="mx-2">‚Ä¢</span>
                                    <span>8 posts today</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-2xl font-bold mb-4">Success Stories</h3>
                        <div class="space-y-4">
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <p class="text-gray-600 mb-2">"The PTSD AI coach helped me through my darkest moments. Having 24/7 support made all the difference."</p>
                                <p class="font-semibold">- Alex M.</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <p class="text-gray-600 mb-2">"The nutrition coach helped me understand the connection between food and mood. My depression has significantly improved."</p>
                                <p class="font-semibold">- Sarah T.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- PTSD Corner Section -->
        <section id="ptsd-corner" class="section hidden">
            <div class="container mx-auto py-8 px-4">
                <!-- Crisis Resources Banner -->
                <div class="crisis-alert rounded-lg p-6 mb-8 text-center">
                    <h2 class="text-2xl font-bold mb-4">üö® Crisis Resources Available 24/7</h2>
                    <div class="grid md:grid-cols-3 gap-4">
                        <div>
                            <strong>UK: Samaritans</strong><br>
                            <a href="tel:116123" class="text-blue-600 font-bold">116 123</a>
                        </div>
                        <div>
                            <strong>US: Crisis Lifeline</strong><br>
                            <a href="tel:988" class="text-blue-600 font-bold">988</a>
                        </div>
                        <div>
                            <strong>Emergency Services</strong><br>
                            <a href="tel:999" class="text-red-600 font-bold">999 (UK) / 911 (US)</a>
                        </div>
                    </div>
                </div>

                <h2 class="text-3xl md:text-4xl font-bold text-center mb-8">üõ°Ô∏è PTSD Corner - Safe Space</h2>
                
                <div class="grid lg:grid-cols-3 gap-8 mb-12">
                    <!-- Interactive Journaling -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-2xl font-bold mb-4 text-purple-600">üìù Interactive Journal</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-bold mb-2">How are you feeling today? (1-10)</label>
                                <input type="range" id="mood-slider" min="1" max="10" value="5" class="w-full">
                                <div class="flex justify-between text-xs text-gray-500">
                                    <span>Very Low</span>
                                    <span id="mood-display">5</span>
                                    <span>Very High</span>
                                </div>
                            </div>
                            <textarea id="journal-entry" placeholder="Write about your day, feelings, or anything on your mind..." class="w-full p-3 border rounded-lg h-32 focus:ring-2 focus:ring-purple-500 focus:border-purple-500"></textarea>
                            <button id="save-journal-btn" class="w-full bg-purple-500 text-white py-2 rounded-lg hover:bg-purple-600 transition-colors">Save Entry</button>
                        </div>
                        <div id="journal-history" class="mt-4 space-y-2 max-h-40 overflow-y-auto"></div>
                    </div>

                    <!-- PTSD AI Specialist -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-2xl font-bold mb-4 text-purple-600">ü§ñ PTSD AI Specialist</h3>
                        <p class="text-gray-600 mb-4">24/7 trauma-informed support with empathetic responses</p>
                        <button id="open-ptsd-chat-btn" class="w-full bg-purple-500 text-white py-3 rounded-lg hover:bg-purple-600 transition-colors mb-4">
                            <i class="fas fa-comments mr-2"></i>Start Support Chat
                        </button>
                        <div class="text-xs text-gray-500">
                            <p>‚úì Crisis detection & intervention</p>
                            <p>‚úì Evidence-based coping strategies</p>
                            <p>‚úì Trauma-informed responses</p>
                        </div>
                    </div>

                    <!-- Crisis Safety Plan -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-2xl font-bold mb-4 text-red-600">üè• Safety Plan Builder</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-bold mb-1">Warning Signs:</label>
                                <textarea id="warning-signs" placeholder="List your personal warning signs..." class="w-full p-2 border rounded text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500" rows="2"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-bold mb-1">Coping Strategies:</label>
                                <textarea id="coping-strategies" placeholder="What helps you cope?" class="w-full p-2 border rounded text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500" rows="2"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-bold mb-1">Emergency Contacts:</label>
                                <input type="text" id="emergency-contact" placeholder="Name and phone number" class="w-full p-2 border rounded text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500">
                            </div>
                            <button id="save-safety-plan-btn" class="w-full bg-red-500 text-white py-2 rounded hover:bg-red-600 transition-colors">Save Safety Plan</button>
                        </div>
                    </div>
                </div>

                <!-- Coping Techniques -->
                <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
                    <h3 class="text-2xl font-bold mb-6">üå± Coping Techniques</h3>
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="coping-technique p-4 rounded-lg cursor-pointer hover:shadow-lg transition-all transform hover:scale-105" data-technique="grounding">
                            <h4 class="font-bold mb-2">5-4-3-2-1 Grounding</h4>
                            <p class="text-sm text-gray-600">Use your senses to stay present</p>
                        </div>
                        <div class="coping-technique p-4 rounded-lg cursor-pointer hover:shadow-lg transition-all transform hover:scale-105" data-technique="breathing">
                            <h4 class="font-bold mb-2">Box Breathing</h4>
                            <p class="text-sm text-gray-600">Calm your nervous system</p>
                        </div>
                        <div class="coping-technique p-4 rounded-lg cursor-pointer hover:shadow-lg transition-all transform hover:scale-105" data-technique="relaxation">
                            <h4 class="font-bold mb-2">Progressive Relaxation</h4>
                            <p class="text-sm text-gray-600">Release physical tension</p>
                        </div>
                        <div class="emdr-technique p-4 rounded-lg cursor-pointer hover:shadow-lg transition-all transform hover:scale-105" data-technique="emdr">
                            <h4 class="font-bold mb-2">EMDR Self-Help</h4>
                            <p class="text-sm text-gray-600">Bilateral stimulation techniques</p>
                        </div>
                    </div>
                </div>

                <!-- Progress Tracking -->
                <div class="bg-white rounded-lg shadow-lg p-8">
                    <h3 class="text-2xl font-bold mb-6">üìä Your Progress</h3>
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="text-center">
                            <div class="w-24 h-24 mx-auto mb-3 relative">
                                <div class="progress-circle w-full h-full">
                                    <div class="progress-fill" data-progress="50"></div>
                                </div>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span class="text-lg font-bold">50%</span>
                                </div>
                            </div>
                            <p class="font-semibold">Recovery Progress</p>
                            <p class="text-sm text-gray-600">Based on journal entries</p>
                        </div>
                        
                        <div class="text-center">
                            <div class="text-3xl font-bold text-green-500 mb-2" id="journal-streak">0</div>
                            <p class="font-semibold">Journal Streak</p>
                            <p class="text-sm text-gray-600">Consecutive days</p>
                        </div>
                        
                        <div class="text-center">
                            <div class="text-3xl font-bold text-blue-500 mb-2" id="coping-used">19</div>
                            <p class="font-semibold">Coping Techniques</p>
                            <p class="text-sm text-gray-600">Used this week</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Pricing Section -->
        <section id="pricing" class="section hidden">
            <div class="container mx-auto py-8 px-4">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-8">Pricing & Plans</h2>
                <div class="text-center mb-8">
                    <p class="text-lg text-gray-600">Choose the plan that best supports your healing journey</p>
                </div>
                
                <!-- Pricing Tiers -->
                <div class="grid md:grid-cols-3 gap-8 mb-12">
                    <!-- Free Plan -->
                    <div class="bg-white rounded-lg shadow-lg p-6 border-2 border-gray-200">
                        <div class="text-center mb-6">
                            <h3 class="text-2xl font-bold mb-2">Free Trial</h3>
                            <div class="text-4xl font-bold text-green-500 mb-2">¬£0</div>
                            <p class="text-gray-600">Try our platform risk-free</p>
                        </div>
                        <ul class="space-y-3 mb-6">
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>5 AI coach interactions daily</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Basic PTSD assessment</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>EMDR self-help techniques</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Crisis support (24/7)</li>
                            <li class="flex items-center"><i class="fas fa-times text-gray-400 mr-2"></i>Advanced nutrition analysis</li>
                            <li class="flex items-center"><i class="fas fa-times text-gray-400 mr-2"></i>Personalized meal planning</li>
                        </ul>
                        <button class="w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 transition-colors" onclick="app.selectPlan('free')">
                            Get Started Free
                        </button>
                    </div>
                    
                    <!-- Standard Plan -->
                    <div class="bg-white rounded-lg shadow-lg p-6 border-2 border-blue-500 relative">
                        <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-blue-500 text-white px-4 py-1 rounded-full text-sm font-bold">
                            Most Popular
                        </div>
                        <div class="text-center mb-6">
                            <h3 class="text-2xl font-bold mb-2">Standard</h3>
                            <div class="text-4xl font-bold text-blue-500 mb-2">¬£29<span class="text-lg">/month</span></div>
                            <p class="text-gray-600">Complete trauma recovery support</p>
                        </div>
                        <ul class="space-y-3 mb-6">
                            <li class="flex items-center"><i class="fas fa-check text-blue-500 mr-2"></i>Unlimited AI coach interactions</li>
                            <li class="flex items-center"><i class="fas fa-check text-blue-500 mr-2"></i>Advanced PTSD assessments</li>
                            <li class="flex items-center"><i class="fas fa-check text-blue-500 mr-2"></i>Professional nutrition analysis</li>
                            <li class="flex items-center"><i class="fas fa-check text-blue-500 mr-2"></i>Personalized meal planning</li>
                            <li class="flex items-center"><i class="fas fa-check text-blue-500 mr-2"></i>Progress tracking & analytics</li>
                            <li class="flex items-center"><i class="fas fa-check text-blue-500 mr-2"></i>Priority crisis support</li>
                        </ul>
                        <button class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors" onclick="app.selectPlan('standard')">
                            Choose Standard
                        </button>
                    </div>
                    
                    <!-- Premium Plan -->
                    <div class="bg-white rounded-lg shadow-lg p-6 border-2 border-purple-200">
                        <div class="text-center mb-6">
                            <h3 class="text-2xl font-bold mb-2">Premium</h3>
                            <div class="text-4xl font-bold text-purple-500 mb-2">¬£59<span class="text-lg">/month</span></div>
                            <p class="text-gray-600">Complete healing ecosystem</p>
                        </div>
                        <ul class="space-y-3 mb-6">
                            <li class="flex items-center"><i class="fas fa-check text-purple-500 mr-2"></i>Everything in Standard</li>
                            <li class="flex items-center"><i class="fas fa-check text-purple-500 mr-2"></i>AI-powered photo food analysis</li>
                            <li class="flex items-center"><i class="fas fa-check text-purple-500 mr-2"></i>Advanced EMDR protocols</li>
                            <li class="flex items-center"><i class="fas fa-check text-purple-500 mr-2"></i>Therapist referral network</li>
                            <li class="flex items-center"><i class="fas fa-check text-purple-500 mr-2"></i>Family/caregiver access</li>
                            <li class="flex items-center"><i class="fas fa-check text-purple-500 mr-2"></i>Priority phone support</li>
                        </ul>
                        <button class="w-full bg-purple-500 text-white py-3 rounded-lg hover:bg-purple-600 transition-colors" onclick="app.selectPlan('premium')">
                            Choose Premium
                        </button>
                    </div>
                </div>
                
                <!-- Enterprise Section -->
                <div class="bg-gradient-to-br from-purple-50 to-blue-50 rounded-lg p-8">
                    <h3 class="text-2xl font-bold mb-4 text-center">üè¢ Enterprise Solutions</h3>
                    <p class="text-lg text-gray-700 mb-8 text-center">Deploy Root Cause Power to your employees and see transformational results in workplace wellbeing</p>
                    
                    <!-- Enterprise Calculator -->
                    <div class="bg-white p-6 rounded-lg shadow-lg mb-6">
                        <h4 class="text-xl font-bold mb-4 text-center">üíº Enterprise Cost Calculator</h4>
                        
                        <!-- Calculator Inputs -->
                        <div class="grid md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Number of Employees</label>
                                <input type="range" id="user-count" min="10" max="1000" value="50" class="w-full">
                                <div class="text-center mt-1 text-lg font-semibold" id="user-count-display">50 employees</div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Organization Type</label>
                                <select id="org-type-calc" class="w-full p-2 border rounded-lg">
                                    <option value="startup" data-multiplier="0.8">Startup/Small Business</option>
                                    <option value="clinic" data-multiplier="1.0">Healthcare Clinic</option>
                                    <option value="hospital" data-multiplier="1.2">Hospital System</option>
                                    <option value="corporation" data-multiplier="1.1">Corporation</option>
                                    <option value="government" data-multiplier="0.9">Government/Non-profit</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Simple Add-ons -->
                        <div class="mb-6">
                            <h5 class="font-medium text-gray-700 mb-3">Optional Features</h5>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" id="admin-dashboard" class="mr-2">
                                    <span class="text-sm">HR Admin Dashboard (Free - Basic employee tracking)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="usage-reports" class="mr-2">
                                    <span class="text-sm">Monthly Usage Reports (Free - Track employee engagement)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="priority-support" class="mr-2">
                                    <span class="text-sm">Priority Support (+¬£100/month)</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Pricing Display -->
                        <div class="bg-gradient-to-r from-purple-50 to-blue-50 p-4 rounded-lg">
                            <div class="grid md:grid-cols-3 gap-4 text-center">
                                <div>
                                    <div class="text-2xl font-bold text-purple-600" id="monthly-cost">¬£750</div>
                                    <div class="text-sm text-gray-600">Monthly Cost</div>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-blue-600" id="setup-cost">¬£0</div>
                                    <div class="text-sm text-gray-600">One-time Setup</div>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-green-600" id="annual-cost">¬£9,000</div>
                                    <div class="text-sm text-gray-600">Annual Total</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Volume Discount Info -->
                        <div class="mt-4 text-sm text-gray-600 text-center">
                            <p>üí∞ Volume Discounts: 10% off 100+ employees | 20% off 200+ | 30% off 500+</p>
                        </div>
                    </div>
                    
                    <!-- Enterprise Subscription Tiers -->
                    <div class="grid md:grid-cols-3 gap-6 mb-8">
                        <!-- Essential Enterprise -->
                        <div class="bg-white rounded-lg shadow-lg p-6 border-2 border-blue-200">
                            <div class="text-center mb-4">
                                <h4 class="text-xl font-bold text-blue-600 mb-2">Essential</h4>
                                <div class="text-3xl font-bold text-blue-600 mb-1">¬£12</div>
                                <div class="text-sm text-gray-600">per employee/month</div>
                                <div class="text-xs text-gray-500">Minimum 25 employees</div>
                            </div>
                            <ul class="text-sm space-y-2 mb-6">
                                <li class="flex items-center"><i class="fas fa-check text-blue-500 mr-2"></i>Core AI health assessment</li>
                                <li class="flex items-center"><i class="fas fa-check text-blue-500 mr-2"></i>Basic PTSD support tools</li>
                                <li class="flex items-center"><i class="fas fa-check text-blue-500 mr-2"></i>Employee dashboard</li>
                                <li class="flex items-center"><i class="fas fa-check text-blue-500 mr-2"></i>Monthly wellness reports</li>
                                <li class="flex items-center"><i class="fas fa-check text-blue-500 mr-2"></i>Email support</li>
                            </ul>
                            <button onclick="app.selectPlan('enterprise-essential')" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors font-semibold">
                                Choose Essential
                            </button>
                        </div>
                        
                        <!-- Professional Enterprise -->
                        <div class="bg-white rounded-lg shadow-lg p-6 border-2 border-purple-500 relative">
                            <div class="absolute -top-3 left-1/2 transform -translate-x-1/2">
                                <span class="bg-purple-500 text-white px-3 py-1 rounded-full text-sm font-bold">MOST POPULAR</span>
                            </div>
                            <div class="text-center mb-4">
                                <h4 class="text-xl font-bold text-purple-600 mb-2">Professional</h4>
                                <div class="text-3xl font-bold text-purple-600 mb-1">¬£18</div>
                                <div class="text-sm text-gray-600">per employee/month</div>
                                <div class="text-xs text-gray-500">Minimum 50 employees</div>
                            </div>
                            <ul class="text-sm space-y-2 mb-6">
                                <li class="flex items-center"><i class="fas fa-check text-purple-500 mr-2"></i>Everything in Essential</li>
                                <li class="flex items-center"><i class="fas fa-check text-purple-500 mr-2"></i>Advanced AI coaching</li>
                                <li class="flex items-center"><i class="fas fa-check text-purple-500 mr-2"></i>Crisis intervention system</li>
                                <li class="flex items-center"><i class="fas fa-check text-purple-500 mr-2"></i>HR analytics dashboard</li>
                                <li class="flex items-center"><i class="fas fa-check text-purple-500 mr-2"></i>Custom branding</li>
                                <li class="flex items-center"><i class="fas fa-check text-purple-500 mr-2"></i>Priority phone support</li>
                            </ul>
                            <button onclick="app.selectPlan('enterprise-professional')" class="w-full bg-purple-500 text-white py-3 rounded-lg hover:bg-purple-600 transition-colors font-semibold">
                                Choose Professional
                            </button>
                        </div>
                        
                        <!-- Enterprise Plus -->
                        <div class="bg-white rounded-lg shadow-lg p-6 border-2 border-green-200">
                            <div class="text-center mb-4">
                                <h4 class="text-xl font-bold text-green-600 mb-2">Enterprise Plus</h4>
                                <div class="text-3xl font-bold text-green-600 mb-1">¬£25</div>
                                <div class="text-sm text-gray-600">per employee/month</div>
                                <div class="text-xs text-gray-500">Minimum 100 employees</div>
                            </div>
                            <ul class="text-sm space-y-2 mb-6">
                                <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Everything in Professional</li>
                                <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>EHR integration</li>
                                <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Advanced analytics & reporting</li>
                                <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Multi-site management</li>
                                <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Dedicated success manager</li>
                                <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>24/7 priority support</li>
                            </ul>
                            <button onclick="app.selectPlan('enterprise-plus')" class="w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 transition-colors font-semibold">
                                Choose Enterprise Plus
                            </button>
                        </div>
                    </div>
                
                    <div class="bg-purple-50 p-4 rounded-lg mb-6">
                            <h5 class="font-bold mb-3">‚ú® What's Included for Every Employee:</h5>
                            <div class="grid md:grid-cols-2 gap-2 text-sm">
                                <div>‚úÖ Complete AI-driven health analysis</div>
                                <div>‚úÖ Personalized recovery prescriptions</div>
                                <div>‚úÖ 24/7 AI coaching support</div>
                                <div>‚úÖ PTSD & trauma specialist</div>
                                <div>‚úÖ Progress tracking dashboard</div>
                                <div>‚úÖ Crisis intervention system</div>
                                <div>‚úÖ Nutrition & sleep optimization</div>
                                <div>‚úÖ Admin dashboard for HR</div>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-green-50 p-4 rounded border-l-4 border-green-500">
                                <h6 class="font-bold text-green-800 mb-2">üìä ROI Benefits</h6>
                                <ul class="text-sm text-green-700 space-y-1">
                                    <li>‚Ä¢ Reduced sick days (avg 35% improvement)</li>
                                    <li>‚Ä¢ Lower healthcare costs</li>
                                    <li>‚Ä¢ Improved productivity & engagement</li>
                                    <li>‚Ä¢ Reduced staff turnover</li>
                                </ul>
                            </div>
                            <div class="bg-blue-50 p-4 rounded border-l-4 border-blue-500">
                                <h6 class="font-bold text-blue-800 mb-2">üéØ Perfect For</h6>
                                <ul class="text-sm text-blue-700 space-y-1">
                                    <li>‚Ä¢ Healthcare organizations</li>
                                    <li>‚Ä¢ First responder teams</li>
                                    <li>‚Ä¢ High-stress workplaces</li>
                                    <li>‚Ä¢ Any company caring about wellbeing</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="text-center space-x-4">
                            <button onclick="app.buyEnterpriseNow()" class="bg-purple-600 text-white px-8 py-4 rounded-lg hover:bg-purple-700 transition-colors text-lg font-bold shadow-lg">
                                üöÄ Deploy Now - Start in 24 Hours
                            </button>
                            <button onclick="app.scheduleDemo()" class="bg-blue-500 text-white px-6 py-4 rounded-lg hover:bg-blue-600 transition-colors">
                                üìû Book Demo Call
                            </button>
                        </div>
                        
                        <div class="text-center mt-4 text-sm text-gray-600">
                            <p>üîí Secure ‚Ä¢ GDPR Compliant ‚Ä¢ No Long-term Contracts</p>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-3 gap-6 mb-6">
                        <div class="text-center">
                            <i class="fas fa-hospital text-3xl text-blue-500 mb-2"></i>
                            <h4 class="font-bold">Healthcare Integration</h4>
                            <p class="text-sm text-gray-600">EHR integration, HIPAA compliance, clinical dashboards</p>
                        </div>
                        <div class="text-center">
                            <i class="fas fa-users text-3xl text-green-500 mb-2"></i>
                            <h4 class="font-bold">Multi-User Management</h4>
                            <p class="text-sm text-gray-600">Therapist portals, patient monitoring, team collaboration</p>
                        </div>
                        <div class="text-center">
                            <i class="fas fa-chart-bar text-3xl text-purple-500 mb-2"></i>
                            <h4 class="font-bold">Analytics & Reporting</h4>
                            <p class="text-sm text-gray-600">Outcome tracking, population health metrics, research tools</p>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Security -->
                <div class="mt-12 text-center">
                    <h3 class="text-xl font-bold mb-4">Secure Payment Processing</h3>
                    <div class="flex justify-center items-center space-x-6 text-gray-600">
                        <i class="fab fa-stripe text-2xl"></i>
                        <i class="fas fa-lock text-xl"></i>
                        <span class="text-sm">256-bit SSL Encryption</span>
                        <i class="fas fa-shield-alt text-xl"></i>
                        <span class="text-sm">GDPR Compliant</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Help Section -->
        <section id="help" class="section hidden">
            <div class="container mx-auto py-8 px-4">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-8">Help & Support</h2>
                <div class="grid lg:grid-cols-2 gap-8">
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-2xl font-bold mb-4">Frequently Asked Questions</h3>
                        <div class="space-y-4">
                            <div class="faq-item border-b pb-2">
                                <h4 class="font-bold cursor-pointer flex items-center justify-between">
                                    How does the PTSD support work?
                                    <i class="fas fa-chevron-down"></i>
                                </h4>
                                <div class="faq-answer hidden mt-2 text-gray-600">
                                    Our AI PTSD specialist is trained in trauma-informed care and available 24/7. It uses evidence-based approaches including CBT, EMDR techniques, and grounding exercises.
                                </div>
                            </div>
                            <div class="faq-item border-b pb-2">
                                <h4 class="font-bold cursor-pointer flex items-center justify-between">
                                    Is this a substitute for professional therapy?
                                    <i class="fas fa-chevron-down"></i>
                                </h4>
                                <div class="faq-answer hidden mt-2 text-gray-600">
                                    No, this platform is designed to supplement professional care, not replace it. We strongly encourage working with qualified mental health professionals for comprehensive treatment.
                                </div>
                            </div>
                            <div class="faq-item border-b pb-2">
                                <h4 class="font-bold cursor-pointer flex items-center justify-between">
                                    How secure is my personal information?
                                    <i class="fas fa-chevron-down"></i>
                                </h4>
                                <div class="faq-answer hidden mt-2 text-gray-600">
                                    We use enterprise-grade encryption and follow HIPAA guidelines to protect your privacy. Your data is never shared without your explicit consent.
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-2xl font-bold mb-4">Contact Support</h3>
                        <div class="space-y-4">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-envelope text-green-500 text-xl"></i>
                                <div>
                                    <div class="font-semibold">Email Support</div>
                                    <div class="text-gray-600">support@rootcausepower.com</div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-clock text-blue-500 text-xl"></i>
                                <div>
                                    <div class="font-semibold">Response Time</div>
                                    <div class="text-gray-600">Usually within 24 hours</div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-shield-alt text-purple-500 text-xl"></i>
                                <div>
                                    <div class="font-semibold">Crisis Support</div>
                                    <div class="text-gray-600">24/7 AI support available</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Modals -->
    <div id="login-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-lg max-w-md w-full mx-4">
            <h2 class="text-2xl font-bold mb-4">Login</h2>
            <div class="space-y-4">
                <input type="email" placeholder="Email" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                <input type="password" placeholder="Password" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                <button class="w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 transition-colors">Login</button>
            </div>
            <button class="close-modal mt-4 text-gray-500 hover:text-gray-700">Close</button>
        </div>
    </div>

    <div id="coach-modal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg max-w-4xl w-full mx-4 max-h-[85vh] flex flex-col">
            <div class="flex justify-between items-center mb-4 border-b pb-3">
                <h2 class="text-xl font-bold">AI Coach Chat</h2>
                <button class="close-modal text-gray-500 hover:text-gray-700 text-xl" onclick="app.closeModal('coach-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="coach-content" class="flex-1 overflow-hidden"></div>
        </div>
    </div>

    <div id="ptsd-chat-modal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg max-w-4xl w-full mx-4 max-h-[85vh] flex flex-col">
            <div id="ptsd-chat-content" class="flex flex-col h-full">
                <div class="flex items-center justify-between mb-4 border-b pb-3">
                    <div class="flex items-center">
                        <i class="fas fa-heart text-3xl text-purple-500 mr-3"></i>
                        <div>
                            <h2 class="text-xl font-bold">PTSD Support Specialist</h2>
                            <p class="text-gray-600">Trauma-informed AI support - you're in a safe space</p>
                        </div>
                    </div>
                    <button class="close-modal text-gray-500 hover:text-gray-700 text-xl" onclick="app.closeModal('ptsd-chat-modal')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="ptsd-chat-messages" class="bg-gray-50 p-4 rounded-lg flex-1 min-h-0 overflow-y-auto mb-4 border border-gray-200">
                    <div class="mb-3">
                        <div class="bg-purple-100 p-3 rounded-lg">
                            Hello, I'm here to provide trauma-informed support. This is a safe space. How are you feeling right now?
                        </div>
                    </div>
                </div>
                <div class="space-y-2">
                    <div class="flex space-x-2">
                        <input type="text" id="ptsd-user-input" placeholder="Type your message..." class="flex-1 p-3 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                        <button id="send-ptsd-btn" class="bg-purple-500 text-white px-4 py-3 rounded-lg hover:bg-purple-600 transition-colors md:hidden">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    <div class="text-xs text-gray-500 text-center">
                        <span class="hidden md:inline">Press Enter to send ‚Ä¢ Get personalized PTSD support</span>
                        <span class="md:hidden">Tap send or press Enter ‚Ä¢ Get personalized PTSD support</span>
                    </div>
                </div>
            </div>
            <button class="close-modal mt-4 text-gray-500 hover:text-gray-700">Close</button>
        </div>
    </div>

    <div id="technique-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-lg max-w-2xl w-full mx-4">
            <div id="technique-content"></div>
            <button class="close-modal mt-4 text-gray-500 hover:text-gray-700">Close</button>
        </div>
    </div>

    <div id="emdr-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-lg max-w-4xl w-full mx-4">
            <div id="emdr-content">
                <h2 class="text-2xl font-bold mb-4">EMDR Self-Help Techniques</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="emdr-technique p-4 rounded-lg cursor-pointer hover:shadow-lg transition-all" data-emdr="butterfly">
                        <h4 class="font-bold mb-2">ü¶ã Butterfly Hug</h4>
                        <p class="text-sm">Cross arms over chest and gently tap alternating shoulders</p>
                    </div>
                    <div class="emdr-technique p-4 rounded-lg cursor-pointer hover:shadow-lg transition-all" data-emdr="eyes">
                        <h4 class="font-bold mb-2">üëÅÔ∏è Eye Movements</h4>
                        <p class="text-sm">Follow the moving dot with your eyes while processing</p>
                    </div>
                    <div class="emdr-technique p-4 rounded-lg cursor-pointer hover:shadow-lg transition-all" data-emdr="audio">
                        <h4 class="font-bold mb-2">üéµ Auditory BLS</h4>
                        <p class="text-sm">Listen to alternating sounds while focusing on memory</p>
                    </div>
                    <div class="emdr-technique p-4 rounded-lg cursor-pointer hover:shadow-lg transition-all" data-emdr="tactile">
                        <h4 class="font-bold mb-2">üëã Tactile BLS</h4>
                        <p class="text-sm">Alternate tapping knees or holding buzzers</p>
                    </div>
                </div>
                <div id="emdr-exercise" class="mt-6 p-4 bg-gray-50 rounded-lg">
                    <div id="emdr-instructions"></div>
                </div>
            </div>
            <button class="close-modal mt-4 text-gray-500 hover:text-gray-700">Close</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="./js/app.js?v=1.2.0"></script>
    
    <!-- PWA Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>

    <!-- Emergency EMDR Fix Script -->
    <script>
        // Working EMDR functionality while main app.js has syntax issues
        window.EMDRHelper = {
            currentAudio: null,
            
            playBinauralTone: function(ear) {
                console.log('üéµ Playing binaural tone for', ear, 'ear');
                const audioFile = ear === 'left' ? 'audio/bilateral-tones-left.wav' : 'audio/bilateral-tones-right.wav';
                this.playTherapeuticAudio(audioFile);
            },
            
            startAlternatingTones: function() {
                console.log('üîÑ Starting alternating EMDR tones');
                this.playTherapeuticAudio('audio/alternating-chimes.wav', false);
                
                // Update button state
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = 'üéµ Playing... <span class="text-xs">(10 minutes)</span>';
                button.disabled = true;
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }, 600000); // 10 minutes
            },
            
            startEyeMovementAnimation: function() {
                console.log('üëÅÔ∏è Starting eye movement animation');
                const dot = document.getElementById('moving-dot');
                const track = document.getElementById('eye-movement-track');
                
                if (!dot || !track) {
                    console.error('‚ùå Eye movement elements not found');
                    alert('Eye movement elements not ready. Please try selecting the Eye Movement technique again.');
                    return;
                }
                
                console.log('‚úÖ Starting animation - elements found');
                const trackWidth = track.offsetWidth - 16;
                let position = 0;
                let direction = 1;
                let cycles = 0;
                const maxCycles = 15;
                
                // Reset dot appearance
                dot.classList.remove('bg-green-500');
                dot.classList.add('bg-blue-500');
                dot.style.transform = 'none';
                
                const animate = () => {
                    position += direction * 3; // Slower movement
                    
                    if (position >= trackWidth || position <= 0) {
                        direction *= -1;
                        cycles++;
                        
                        if (cycles >= maxCycles) {
                            // Completed - center the dot and make it green
                            dot.style.left = '50%';
                            dot.style.transform = 'translateX(-50%)';
                            dot.classList.add('bg-green-500');
                            dot.classList.remove('bg-blue-500');
                            console.log('‚úÖ Eye movement completed!');
                            return;
                        }
                    }
                    
                    dot.style.left = position + 'px';
                    requestAnimationFrame(animate);
                };
                
                // Start animation
                animate();
            },
            
            playTherapeuticAudio: function(audioPath, loop = false) {
                try {
                    console.log('üéµ Starting audio:', audioPath);
                    
                    if (this.currentAudio) {
                        this.currentAudio.pause();
                        this.currentAudio.currentTime = 0;
                    }
                    
                    this.currentAudio = new Audio(audioPath);
                    this.currentAudio.volume = 0.7;
                    this.currentAudio.loop = loop;
                    
                    this.currentAudio.play().then(() => {
                        console.log('‚úÖ Audio playing:', audioPath);
                    }).catch(error => {
                        console.error('‚ùå Audio failed:', error);
                        alert('Click anywhere first to enable audio, then try again.');
                    });
                } catch (error) {
                    console.error('‚ùå Audio error:', error);
                    alert('Audio not available. Please check your browser settings.');
                }
            }
        };

        // Modal functionality
        window.openModal = function(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('hidden');
                console.log('‚úÖ Modal opened:', modalId);
            }
        };
        
        window.closeModal = function(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('hidden');
                console.log('‚úÖ Modal closed:', modalId);
            }
        };

        // Make functions globally accessible - CRITICAL: These must be available when EMDR content loads
        window.app = window.app || {};
        
        // Ensure these functions are always available
        window.app.playBinauralTone = function(ear) { 
            console.log('üéµ Global playBinauralTone called with:', ear);
            EMDRHelper.playBinauralTone(ear); 
        };
        
        window.app.startAlternatingTones = function() { 
            console.log('üîÑ Global startAlternatingTones called');
            EMDRHelper.startAlternatingTones(); 
        };
        
        window.app.startEyeMovementAnimation = function() { 
            console.log('üëÅÔ∏è Global startEyeMovementAnimation called');
            EMDRHelper.startEyeMovementAnimation(); 
        };
        
        window.app.openModal = window.openModal;
        window.app.closeModal = window.closeModal;
        
        // BACKUP: Also put functions directly on window in case app object gets overwritten
        window.playBinauralTone = function(ear) { 
            console.log('üéµ Direct window.playBinauralTone called with:', ear);
            EMDRHelper.playBinauralTone(ear); 
        };
        
        window.startAlternatingTones = function() { 
            console.log('üîÑ Direct window.startAlternatingTones called');
            EMDRHelper.startAlternatingTones(); 
        };
        
        window.startEyeMovementAnimation = function() { 
            console.log('üëÅÔ∏è Direct window.startEyeMovementAnimation called');
            EMDRHelper.startEyeMovementAnimation(); 
        };
        
        // Debug: Log what's available
        console.log('üîß Available app functions:', Object.keys(window.app));
        console.log('üîß Direct window functions available:', typeof window.playBinauralTone, typeof window.startAlternatingTones);

        // EMDR technique clicking
        document.addEventListener('click', function(e) {
            // Handle EMDR technique clicks
            if (e.target.matches('[data-technique="emdr"]') || e.target.closest('[data-technique="emdr"]')) {
                console.log('üéØ EMDR technique clicked');
                window.openModal('emdr-modal');
            }
            
            // Handle specific EMDR technique selection
            if (e.target.matches('[data-emdr]') || e.target.closest('[data-emdr]')) {
                const emdrType = e.target.dataset.emdr || e.target.closest('[data-emdr]').dataset.emdr;
                console.log('üéØ EMDR type selected:', emdrType);
                EMDRHelper.startEMDRTechnique(emdrType);
            }
            
            // Handle modal close buttons
            if (e.target.matches('.modal-close') || e.target.closest('.modal-close')) {
                const modal = e.target.closest('.modal');
                if (modal) {
                    modal.classList.add('hidden');
                }
            }
        });

        // Add EMDR technique starter
        EMDRHelper.startEMDRTechnique = function(emdrType) {
            console.log('üéØ Starting EMDR technique:', emdrType);
            const exerciseDiv = document.getElementById('emdr-exercise');
            const instructionsDiv = document.getElementById('emdr-instructions');
            
            if (!exerciseDiv || !instructionsDiv) {
                console.error('‚ùå EMDR elements not found');
                return;
            }
            
            exerciseDiv.classList.remove('hidden');
            
            switch(emdrType) {
                case 'butterfly':
                    this.startButterflyHug(instructionsDiv);
                    break;
                case 'eyes':
                    this.startEyeMovements(instructionsDiv);
                    break;
                case 'audio':
                    this.startAuditoryBLS(instructionsDiv);
                    break;
                case 'tactile':
                    this.startTactileBLS(instructionsDiv);
                    break;
                default:
                    console.error('‚ùå Unknown EMDR technique:', emdrType);
            }
        };

        // EMDR Content Functions
        EMDRHelper.startButterflyHug = function(container) {
            container.innerHTML = `
                <h4 class="font-bold mb-3">ü¶ã Butterfly Hug Technique</h4>
                <div class="space-y-3">
                    <div class="flex items-center space-x-4 mb-4">
                        <div class="text-4xl">ü§ó</div>
                        <div>
                            <p class="font-medium">Step-by-step instructions:</p>
                        </div>
                    </div>
                    <div class="space-y-2 text-sm">
                        <p><strong>1.</strong> Cross your arms over your chest, like giving yourself a hug</p>
                        <p><strong>2.</strong> Place your hands on your shoulders (right hand on left shoulder, left hand on right shoulder)</p>
                        <p><strong>3.</strong> Gently tap alternating shoulders: left, right, left, right...</p>
                        <p><strong>4.</strong> Continue for 30-60 seconds while breathing naturally</p>
                        <p><strong>5.</strong> Think of something positive or just focus on the tapping sensation</p>
                    </div>
                    <div class="mt-4 p-3 bg-blue-50 rounded">
                        <p class="text-sm"><strong>Benefits:</strong> This creates bilateral stimulation which can help process emotions and create a sense of safety and self-soothing.</p>
                    </div>
                    <div class="mt-4 p-3 bg-green-50 rounded">
                        <p class="text-sm text-green-700"><strong>Remember:</strong> You are giving yourself compassion and care. You deserve this kindness.</p>
                    </div>
                </div>
            `;
        };

        EMDRHelper.startEyeMovements = function(container) {
            container.innerHTML = `
                <h4 class="font-bold mb-3">üëÅÔ∏è Eye Movement Technique</h4>
                <div class="text-center mb-4">
                    <div class="w-full h-20 bg-gray-100 rounded relative overflow-hidden" id="eye-movement-track">
                        <div class="w-4 h-4 bg-blue-500 rounded-full absolute top-8 transition-all duration-2000" id="moving-dot" style="left: 10px;"></div>
                    </div>
                </div>
                <div class="space-y-2 text-sm">
                    <p><strong>Instructions:</strong></p>
                    <p>‚Ä¢ Follow the moving dot with your eyes only (don't move your head)</p>
                    <p>‚Ä¢ While following the dot, think of a mildly positive memory or just focus on the movement</p>
                    <p>‚Ä¢ Continue for 30 seconds, then take a break</p>
                    <p>‚Ä¢ Notice any changes in how you feel</p>
                </div>
                <button onclick="(window.app && window.app.startEyeMovementAnimation) ? window.app.startEyeMovementAnimation() : window.startEyeMovementAnimation()" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors">Start Eye Movement</button>
                <div class="mt-4 p-3 bg-yellow-50 rounded">
                    <p class="text-xs"><strong>Note:</strong> Start with positive or neutral memories. If you feel overwhelmed, stop and use grounding techniques.</p>
                </div>
            `;
        };

        EMDRHelper.startAuditoryBLS = function(container) {
            container.innerHTML = `
                <h4 class="font-bold mb-3">üéµ Auditory Bilateral Stimulation</h4>
                <div class="space-y-4">
                    <p class="text-sm">This technique uses alternating sounds to create bilateral stimulation:</p>
                    
                    <div class="bg-blue-50 p-3 rounded-lg mb-4">
                        <p class="text-xs text-blue-700"><strong>üéß Instructions:</strong> Use headphones for best effect. Click any button below to start.</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="(window.app && window.app.playBinauralTone) ? window.app.playBinauralTone('left') : window.playBinauralTone('left')" class="bg-blue-500 text-white p-4 rounded hover:bg-blue-600 transition-colors">
                            üéß Left Ear<br><span class="text-xs">Play tone</span>
                        </button>
                        <button onclick="(window.app && window.app.playBinauralTone) ? window.app.playBinauralTone('right') : window.playBinauralTone('right')" class="bg-green-500 text-white p-4 rounded hover:bg-green-600 transition-colors">
                            üéß Right Ear<br><span class="text-xs">Play tone</span>
                        </button>
                    </div>
                    <button onclick="(window.app && window.app.startAlternatingTones) ? window.app.startAlternatingTones() : window.startAlternatingTones()" class="w-full bg-purple-500 text-white p-3 rounded hover:bg-purple-600 transition-colors">
                        üîÑ Start Professional EMDR Audio (10 min)
                    </button>
                    <div class="space-y-1 text-xs text-gray-600">
                        <p><strong>Instructions:</strong></p>
                        <p>‚Ä¢ Use headphones for best effect</p>
                        <p>‚Ä¢ Focus on something positive while listening</p>
                        <p>‚Ä¢ Let the alternating sounds help process emotions</p>
                        <p>‚Ä¢ Continue for 2-3 minutes or until you feel calmer</p>
                    </div>
                </div>
            `;
        };

        EMDRHelper.startTactileBLS = function(container) {
            container.innerHTML = `
                <h4 class="font-bold mb-3">üëã Tactile Bilateral Stimulation</h4>
                <div class="space-y-4">
                    <p class="text-sm">Use touch to create bilateral stimulation:</p>
                    
                    <div class="bg-blue-50 p-4 rounded">
                        <p class="font-medium mb-2">ü¶µ Knee Tapping Method:</p>
                        <div class="space-y-1 text-sm">
                            <p>‚Ä¢ Sit comfortably and place hands on knees</p>
                            <p>‚Ä¢ Alternate tapping left knee, then right knee</p>
                            <p>‚Ä¢ Maintain steady rhythm (about 1 tap per second)</p>
                            <p>‚Ä¢ Continue for 1-2 minutes while breathing deeply</p>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 p-4 rounded">
                        <p class="font-medium mb-2">ü§ó Self-Hug Tapping:</p>
                        <div class="space-y-1 text-sm">
                            <p>‚Ä¢ Cross arms and place hands on opposite shoulders</p>
                            <p>‚Ä¢ Gently pat alternating shoulders</p>
                            <p>‚Ä¢ Focus on something calming while tapping</p>
                            <p>‚Ä¢ This combines bilateral stimulation with self-soothing</p>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 p-4 rounded">
                        <p class="font-medium mb-2">üì± Using Your Phone:</p>
                        <div class="space-y-1 text-sm">
                            <p>‚Ä¢ Hold your phone in alternating hands</p>
                            <p>‚Ä¢ Set it to vibrate and pass it left-right-left-right</p>
                            <p>‚Ä¢ Or use EMDR apps with bilateral vibration</p>
                        </div>
                    </div>
                    
                    <div class="text-center p-3 bg-purple-50 rounded">
                        <p class="text-sm text-purple-700 font-medium">Remember: Go at your own pace. Stop if you feel overwhelmed.</p>
                    </div>
                </div>
            `;
        };

        console.log('‚úÖ EMDR Emergency Functions Loaded - All techniques available!');

        // ===========================================
        // üß† AI-POWERED ASSESSMENT SYSTEM - EMERGENCY BYPASS
        // ===========================================
        
        window.AIAssessment = {
            currentStep: 1,
            totalSteps: 10,
            responses: {},
            conversationHistory: [],
            followUpQuestions: [],
            
            // Assessment questions with AI-driven follow-ups
            questions: [
                {
                    id: 1,
                    type: 'scale',
                    title: 'Energy & Vitality',
                    question: 'How would you rate your overall energy levels throughout the day?',
                    scale: { min: 1, max: 5, labels: ['Exhausted', 'Low', 'Moderate', 'Good', 'Excellent'] },
                    crisis_indicators: ['sleep disruption', 'chronic fatigue', 'depression']
                },
                {
                    id: 2,
                    type: 'scale', 
                    title: 'Sleep Quality',
                    question: 'How well are you sleeping these days?',
                    scale: { min: 1, max: 5, labels: ['Terrible', 'Poor', 'Fair', 'Good', 'Excellent'] },
                    crisis_indicators: ['insomnia', 'nightmares', 'sleep anxiety']
                },
                {
                    id: 3,
                    type: 'scale',
                    title: 'Emotional Wellbeing', 
                    question: 'How are you feeling emotionally right now in your life?',
                    scale: { min: 1, max: 5, labels: ['Very Struggling', 'Struggling', 'Okay', 'Good', 'Thriving'] },
                    crisis_indicators: ['suicidal thoughts', 'self-harm', 'severe depression', 'panic attacks']
                },
                {
                    id: 4,
                    type: 'scale',
                    title: 'Stress Management',
                    question: 'How well are you managing stress in your daily life?',
                    scale: { min: 1, max: 5, labels: ['Overwhelmed', 'Struggling', 'Coping', 'Managing Well', 'Thriving'] },
                    crisis_indicators: ['chronic stress', 'burnout', 'anxiety disorders']
                },
                {
                    id: 5,
                    type: 'multiple',
                    title: 'Physical Activity',
                    question: 'Which best describes your current physical activity level?',
                    options: [
                        'I rarely exercise or move much',
                        'Light activity 1-2 times per week',
                        'Moderate exercise 2-3 times per week', 
                        'Regular exercise 4-5 times per week',
                        'Very active - daily movement/exercise'
                    ]
                },
                {
                    id: 6,
                    type: 'multiple',
                    title: 'Nutrition & Eating',
                    question: 'How would you describe your current eating patterns?',
                    options: [
                        'Very poor - mostly processed/fast food',
                        'Below average - some healthy choices',
                        'Mixed - healthy and unhealthy foods',
                        'Mostly healthy with occasional treats',
                        'Excellent - consistently nutritious choices'
                    ]
                },
                {
                    id: 7,
                    type: 'scale',
                    title: 'Social Connections',
                    question: 'How satisfied are you with your social relationships and support system?',
                    scale: { min: 1, max: 5, labels: ['Very Isolated', 'Lonely', 'Some Support', 'Good Connections', 'Strong Network'] },
                    crisis_indicators: ['social isolation', 'relationship trauma', 'trust issues']
                },
                {
                    id: 8,
                    type: 'scale', 
                    title: 'Life Balance',
                    question: 'How balanced does your life feel between work, rest, and personal time?',
                    scale: { min: 1, max: 5, labels: ['Chaotic', 'Unbalanced', 'Somewhat Balanced', 'Well Balanced', 'Harmonious'] }
                },
                {
                    id: 9,
                    type: 'multiple',
                    title: 'Trauma & Difficult Experiences',
                    question: 'Have you experienced any significant trauma or challenging life events?',
                    options: [
                        'No significant trauma or challenges',
                        'Some difficult experiences, but manageable',
                        'Moderate trauma - affects me sometimes',
                        'Significant trauma - impacts my daily life',
                        'Severe trauma - significantly affects my functioning'
                    ],
                    crisis_indicators: ['PTSD', 'trauma responses', 'flashbacks', 'dissociation']
                },
                {
                    id: 10,
                    type: 'text',
                    title: 'Your Goals & Hopes',
                    question: 'What are your main hopes or goals for improving your wellbeing? (Tell us in your own words)',
                    placeholder: 'e.g., I want to feel more energetic, manage my anxiety better, improve my relationships...'
                }
            ],

            // Initialize the AI assessment system
            init: function() {
                console.log('üß† Initializing AI Assessment System');
                this.bindAssessmentNavigation();
                this.loadAssessmentStep();
            },

            // Bind navigation events
            bindAssessmentNavigation: function() {
                // Assessment navigation clicks
                document.addEventListener('click', (e) => {
                    if (e.target.matches('[data-section="assessment"]')) {
                        console.log('üéØ Assessment section clicked');
                        this.showAssessmentSection();
                    }
                });
            },

            // Show assessment section and start
            showAssessmentSection: function() {
                // Hide all sections
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.add('hidden');
                });
                
                // Show assessment section
                const assessmentSection = document.getElementById('assessment');
                if (assessmentSection) {
                    assessmentSection.classList.remove('hidden');
                    this.loadAssessmentStep();
                }
            },

            // Load current assessment step
            loadAssessmentStep: function() {
                const container = document.getElementById('assessment-questions');
                if (!container) return;

                const question = this.questions[this.currentStep - 1];
                if (!question) {
                    this.completeAssessment();
                    return;
                }

                // Update progress
                this.updateProgress();

                // Generate question HTML
                container.innerHTML = this.generateQuestionHTML(question);
            },

            // Generate HTML for different question types
            generateQuestionHTML: function(question) {
                let html = `
                    <div class="question-container">
                        <div class="mb-6">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-blue-500 rounded-full flex items-center justify-center text-white font-bold text-lg mr-4">
                                    ${question.id}
                                </div>
                                <div>
                                    <h3 class="text-xl font-semibold text-gray-800">${question.title}</h3>
                                    <p class="text-sm text-gray-600">Step ${this.currentStep} of ${this.totalSteps}</p>
                                </div>
                            </div>
                            
                            <p class="text-lg text-gray-700 mb-6">${question.question}</p>
                        </div>
                        
                        <div class="answer-area">
                `;

                if (question.type === 'scale') {
                    html += this.generateScaleHTML(question);
                } else if (question.type === 'multiple') {
                    html += this.generateMultipleChoiceHTML(question);
                } else if (question.type === 'text') {
                    html += this.generateTextHTML(question);
                }

                html += `
                        </div>
                        
                        <div class="mt-8 flex justify-between">
                            <button onclick="AIAssessment.previousStep()" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors" ${this.currentStep === 1 ? 'disabled' : ''}>
                                ‚Üê Previous
                            </button>
                            <div class="text-sm text-gray-500 self-center">
                                ${this.currentStep}/${this.totalSteps}
                            </div>
                            <button onclick="AIAssessment.nextStep()" class="px-6 py-2 bg-gradient-to-r from-purple-500 to-blue-500 text-white rounded-lg hover:shadow-lg transition-all">
                                ${this.currentStep === this.totalSteps ? 'Complete Analysis ‚Üí' : 'Next ‚Üí'}
                            </button>
                        </div>
                    </div>
                `;

                return html;
            },

            // Generate scale question HTML
            generateScaleHTML: function(question) {
                let html = `
                    <div class="scale-question">
                        <div class="grid grid-cols-5 gap-2 mb-4">
                `;

                for (let i = question.scale.min; i <= question.scale.max; i++) {
                    html += `
                        <div class="text-center">
                            <button onclick="AIAssessment.selectScale(${question.id}, ${i})" 
                                    class="scale-option w-full p-3 rounded-lg border-2 border-gray-200 hover:border-purple-400 hover:bg-purple-50 transition-all"
                                    data-value="${i}">
                                <div class="text-2xl font-bold text-purple-600 mb-1">${i}</div>
                                <div class="text-xs text-gray-600">${question.scale.labels[i-1]}</div>
                            </button>
                        </div>
                    `;
                }

                html += `
                        </div>
                        <p class="text-sm text-gray-500 text-center">Click a number to rate your experience</p>
                    </div>
                `;

                return html;
            },

            // Generate multiple choice HTML
            generateMultipleChoiceHTML: function(question) {
                let html = `<div class="multiple-choice space-y-3">`;

                question.options.forEach((option, index) => {
                    html += `
                        <button onclick="AIAssessment.selectMultiple(${question.id}, ${index})" 
                                class="multiple-option w-full p-4 text-left border-2 border-gray-200 rounded-lg hover:border-purple-400 hover:bg-purple-50 transition-all"
                                data-value="${index}">
                            <div class="flex items-center">
                                <div class="w-6 h-6 border-2 border-gray-300 rounded-full mr-3 flex-shrink-0"></div>
                                <span class="text-gray-800">${option}</span>
                            </div>
                        </button>
                    `;
                });

                html += `</div>`;
                return html;
            },

            // Generate text input HTML
            generateTextHTML: function(question) {
                return `
                    <div class="text-question">
                        <textarea 
                            id="text-response-${question.id}"
                            placeholder="${question.placeholder || 'Share your thoughts...'}"
                            class="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-purple-400 focus:outline-none resize-none"
                            rows="4"
                            onchange="AIAssessment.selectText(${question.id}, this.value)">
                        </textarea>
                        <p class="text-sm text-gray-500 mt-2">Take your time - your words help us understand your unique situation</p>
                    </div>
                `;
            },

            // Handle scale selection
            selectScale: function(questionId, value) {
                console.log(`üìä Scale response: Q${questionId} = ${value}`);
                this.responses[questionId] = { type: 'scale', value: value };
                
                // Visual feedback
                document.querySelectorAll('.scale-option').forEach(option => {
                    option.classList.remove('bg-purple-100', 'border-purple-500');
                });
                document.querySelector(`[data-value="${value}"]`).classList.add('bg-purple-100', 'border-purple-500');
                
                // Check for AI follow-up
                this.checkForAIFollowUp(questionId, value);
            },

            // Handle multiple choice selection
            selectMultiple: function(questionId, optionIndex) {
                console.log(`üìù Multiple choice response: Q${questionId} = ${optionIndex}`);
                this.responses[questionId] = { type: 'multiple', value: optionIndex };
                
                // Visual feedback
                document.querySelectorAll('.multiple-option').forEach(option => {
                    option.classList.remove('bg-purple-100', 'border-purple-500');
                });
                document.querySelector(`[data-value="${optionIndex}"]`).classList.add('bg-purple-100', 'border-purple-500');
                
                // Check for AI follow-up
                this.checkForAIFollowUp(questionId, optionIndex);
            },

            // Handle text input
            selectText: function(questionId, text) {
                console.log(`‚úçÔ∏è Text response: Q${questionId} = ${text.substring(0, 50)}...`);
                this.responses[questionId] = { type: 'text', value: text };
                
                // Check for AI follow-up with text analysis
                if (text.length > 20) {
                    this.checkForAIFollowUp(questionId, text);
                }
            },

            // Update progress display
            updateProgress: function() {
                const progressBar = document.querySelector('.progress-bar');
                const progressText = document.querySelector('.progress-text');
                
                if (progressBar) {
                    const percentage = (this.currentStep / this.totalSteps) * 100;
                    progressBar.style.width = percentage + '%';
                }
                
                if (progressText) {
                    progressText.textContent = `${this.currentStep}/${this.totalSteps}`;
                }
            },

            // Navigation methods
            nextStep: function() {
                if (this.currentStep < this.totalSteps) {
                    this.currentStep++;
                    this.loadAssessmentStep();
                } else {
                    this.completeAssessment();
                }
            },

            previousStep: function() {
                if (this.currentStep > 1) {
                    this.currentStep--;
                    this.loadAssessmentStep();
                }
            },

            // ===========================================
            // ü§ñ AI-POWERED FOLLOW-UP SYSTEM
            // ===========================================

            // Check if response needs AI follow-up
            checkForAIFollowUp: function(questionId, response) {
                const question = this.questions.find(q => q.id === questionId);
                
                // Crisis detection first
                if (this.detectCrisis(question, response)) {
                    this.showCrisisSupport();
                    return;
                }

                // Determine if follow-up needed based on response
                if (this.needsFollowUp(question, response)) {
                    console.log('ü§ñ Generating AI follow-up question...');
                    this.generateAIFollowUp(question, response);
                }
            },

            // Detect crisis indicators
            detectCrisis: function(question, response) {
                const crisisScore = this.calculateCrisisScore();
                
                // Specific crisis triggers
                if (question.id === 3 && response <= 2) { // Emotional wellbeing very low
                    return true;
                }
                
                if (question.id === 9 && response >= 3) { // Significant trauma
                    return true;
                }
                
                // Text analysis for crisis keywords
                if (typeof response === 'string') {
                    const crisisKeywords = ['suicide', 'kill myself', 'end it all', 'can\'t go on', 'hopeless', 'self-harm'];
                    const lowerResponse = response.toLowerCase();
                    return crisisKeywords.some(keyword => lowerResponse.includes(keyword));
                }

                return crisisScore >= 8; // Overall crisis threshold
            },

            // Calculate overall crisis score
            calculateCrisisScore: function() {
                let score = 0;
                Object.entries(this.responses).forEach(([id, resp]) => {
                    if (id <= 3 && resp.value <= 2) score += 3; // Energy, sleep, emotional
                    if (id == 7 && resp.value <= 2) score += 2; // Social isolation
                    if (id == 9 && resp.value >= 4) score += 4; // Severe trauma
                });
                return score;
            },

            // Show crisis support
            showCrisisSupport: function() {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-lg p-8 max-w-lg mx-4">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-heart text-red-500 text-2xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">We Care About You</h3>
                            <p class="text-gray-600">Based on your responses, we want to ensure you have immediate support available.</p>
                        </div>
                        
                        <div class="space-y-4 mb-6">
                            <div class="bg-red-50 p-4 rounded-lg">
                                <h4 class="font-bold text-red-800 mb-2">üö® Crisis Support - Available 24/7</h4>
                                <div class="text-sm text-red-700 space-y-1">
                                    <p><strong>UK:</strong> Samaritans - 116 123 (Free)</p>
                                    <p><strong>US:</strong> Crisis Lifeline - 988</p>
                                    <p><strong>Emergency:</strong> 999 (UK) / 911 (US)</p>
                                </div>
                            </div>
                            
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="font-bold text-blue-800 mb-2">üíô Professional Help</h4>
                                <p class="text-sm text-blue-700">Consider speaking with a mental health professional. Your GP can refer you to local services.</p>
                            </div>
                        </div>
                        
                        <div class="flex space-x-4">
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                                Continue Assessment
                            </button>
                            <button onclick="window.open('tel:116123')" class="flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                                Call Support Now
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
            },

            // Determine if follow-up needed
            needsFollowUp: function(question, response) {
                // Scale questions - follow up on extreme responses
                if (question.type === 'scale') {
                    return response <= 2 || response >= 4;
                }
                
                // Multiple choice - follow up on concerning responses
                if (question.type === 'multiple') {
                    return [0, 3, 4].includes(response); // First, fourth, or fifth options often concerning
                }
                
                // Text - always follow up to understand better
                if (question.type === 'text' && typeof response === 'string' && response.length > 30) {
                    return true;
                }

                return false;
            },

            // Generate AI follow-up question
            generateAIFollowUp: function(question, response) {
                const context = this.prepareContextForAI(question, response);
                
                // Use the same API key approach as EMDR
                this.callAIForFollowUp(context).then(followUpQuestion => {
                    this.showFollowUpQuestion(followUpQuestion);
                }).catch(error => {
                    console.error('‚ùå AI follow-up failed:', error);
                    // Continue without follow-up
                });
            },

            // Prepare context for AI
            prepareContextForAI: function(question, response) {
                return {
                    currentQuestion: question,
                    userResponse: response,
                    previousResponses: this.responses,
                    step: this.currentStep,
                    context: 'trauma-informed PTSD assessment follow-up'
                };
            },

            // Call AI for follow-up question
            callAIForFollowUp: function(context) {
                return new Promise(async (resolve, reject) => {
                    try {
                        const apiKey = await this.getAPIKey();
                        
                        const prompt = `You are a compassionate, trauma-informed coach conducting a sensitive PTSD assessment. 

Current Question: "${context.currentQuestion.question}"
User's Response: ${context.userResponse}

Generate ONE brief, caring follow-up question to better understand their situation. Be:
- Gentle and non-judgmental
- Trauma-informed (don't re-traumatize)  
- Focused on understanding, not diagnosing
- Maximum 20 words

Example good follow-ups:
"What time of day do you feel this most?"
"Has this changed recently for you?"
"What helps you cope when this happens?"

ONLY return the follow-up question, nothing else.`;

                        const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${apiKey}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                model: 'mixtral-8x7b-32768',
                                messages: [{ role: 'user', content: prompt }],
                                max_tokens: 50,
                                temperature: 0.7
                            })
                        });

                        const data = await response.json();
                        if (data.choices && data.choices[0]) {
                            resolve(data.choices[0].message.content.trim());
                        } else {
                            reject(new Error('No AI response'));
                        }
                        
                    } catch (error) {
                        reject(error);
                    }
                });
            },

            // Get API key (reuse EMDR approach)
            getAPIKey: async function() {
                try {
                    const response = await fetch('/api/config');
                    const config = await response.json();
                    if (config.groqApiKey) {
                        return config.groqApiKey;
                    }
                } catch (error) {
                    console.warn('Could not fetch API key from server:', error);
                }
                
                // Fallback
                const userKey = prompt('Please enter your Groq API key for AI features:');
                if (userKey) {
                    localStorage.setItem('groq_api_key', userKey);
                    return userKey;
                }
                
                throw new Error('No API key available');
            },

            // Show follow-up question
            showFollowUpQuestion: function(followUpText) {
                const container = document.getElementById('assessment-questions');
                const followUpDiv = document.createElement('div');
                followUpDiv.className = 'ai-followup mt-6 p-4 bg-blue-50 border-l-4 border-blue-400 rounded-lg';
                followUpDiv.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0 mr-3">
                            <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                <i class="fas fa-robot text-white text-sm"></i>
                            </div>
                        </div>
                        <div class="flex-1">
                            <p class="font-semibold text-blue-800 text-sm mb-2">AI Coach Sarah asks:</p>
                            <p class="text-blue-700 mb-3">${followUpText}</p>
                            <textarea 
                                class="w-full p-3 border border-blue-200 rounded-lg text-sm" 
                                rows="2" 
                                placeholder="Your response (optional)..."
                                onchange="AIAssessment.saveFollowUpResponse('${followUpText}', this.value)">
                            </textarea>
                        </div>
                    </div>
                `;
                
                container.appendChild(followUpDiv);
            },

            // Save follow-up response
            saveFollowUpResponse: function(question, response) {
                if (!this.followUpQuestions) this.followUpQuestions = [];
                this.followUpQuestions.push({ question, response });
                console.log('ü§ñ Follow-up saved:', { question: question.substring(0, 30), response: response.substring(0, 30) });
            }

        };

        // Initialize assessment when page loads
        document.addEventListener('DOMContentLoaded', () => {
            AIAssessment.init();
        });

            // ===========================================
            // üéØ AI RECOVERY PRESCRIPTION SYSTEM  
            // ===========================================

            // Complete assessment and generate prescription
            completeAssessment() {
                console.log('üéØ Assessment completed - generating AI prescription...');
                
                // Show loading state
                this.showPrescriptionLoading();
                
                // Generate AI prescription
                this.generateAIPrescription().then(prescription => {
                    this.showPrescriptionResults(prescription);
                    this.saveToDashboard(prescription);
                }).catch(error => {
                    console.error('‚ùå Prescription generation failed:', error);
                    this.showFallbackPrescription();
                });
            },

            // Show loading state
            showPrescriptionLoading: function() {
                const container = document.getElementById('assessment-questions');
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-purple-500 to-blue-500 rounded-full mb-6 animate-pulse">
                            <i class="fas fa-brain text-white text-3xl"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">AI Coach Sarah is Analyzing Your Responses</h3>
                        <p class="text-gray-600 mb-6">Creating your personalized recovery prescription...</p>
                        <div class="flex justify-center items-center space-x-2">
                            <div class="w-3 h-3 bg-purple-500 rounded-full animate-bounce"></div>
                            <div class="w-3 h-3 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                            <div class="w-3 h-3 bg-purple-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                        </div>
                    </div>
                `;
            },

            // Generate AI prescription
            generateAIPrescription: function() {
                return new Promise(async (resolve, reject) => {
                    try {
                        const apiKey = await this.getAPIKey();
                        const analysisContext = this.prepareAssessmentForAI();
                        
                        const systemPrompt = `You are Coach Sarah, a compassionate trauma-informed wellness coach specializing in PTSD recovery and lifestyle medicine. Generate a personalized recovery prescription based on the user's assessment.

Be warm, hopeful, and specific. Include:
1. Personal acknowledgment of their courage
2. 3-4 key focus areas based on their responses  
3. Specific, actionable steps for the next 2 weeks
4. Crisis support if needed
5. Encouragement about their potential for healing

Keep it under 500 words. Use "you" language. Be professional but caring.`;

                        const userPrompt = `Please create a personalized recovery prescription for this person based on their assessment:

${analysisContext}

Make it hopeful, specific, and actionable. Focus on their strengths and provide clear next steps.`;

                        const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${apiKey}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                model: 'mixtral-8x7b-32768',
                                messages: [
                                    { role: 'system', content: systemPrompt },
                                    { role: 'user', content: userPrompt }
                                ],
                                max_tokens: 800,
                                temperature: 0.8
                            })
                        });

                        const data = await response.json();
                        if (data.choices && data.choices[0]) {
                            resolve(data.choices[0].message.content.trim());
                        } else {
                            reject(new Error('No AI prescription generated'));
                        }
                        
                    } catch (error) {
                        reject(error);
                    }
                });
            },

            // Prepare assessment data for AI analysis
            prepareAssessmentForAI: function() {
                let context = "ASSESSMENT RESULTS:\\n\\n";
                
                this.questions.forEach((question, index) => {
                    const response = this.responses[question.id];
                    if (response) {
                        context += `${question.title}: `;
                        
                        if (response.type === 'scale') {
                            context += `${response.value}/5 (${question.scale.labels[response.value-1]})\\n`;
                        } else if (response.type === 'multiple') {
                            context += `${question.options[response.value]}\\n`;
                        } else if (response.type === 'text') {
                            context += `"${response.value}"\\n`;
                        }
                    }
                });

                // Add follow-up responses
                if (this.followUpQuestions && this.followUpQuestions.length > 0) {
                    context += "\\nADDITIONAL INSIGHTS:\\n";
                    this.followUpQuestions.forEach(fq => {
                        context += `Q: ${fq.question}\\nA: ${fq.response}\\n`;
                    });
                }

                // Add crisis context
                const crisisScore = this.calculateCrisisScore();
                if (crisisScore >= 5) {
                    context += `\\nIMPORTANT: Crisis indicators present (score: ${crisisScore}/15). Include appropriate professional support recommendations.\\n`;
                }

                return context;
            },

            // Show prescription results
            showPrescriptionResults: function(prescription) {
                const container = document.getElementById('assessment-questions');
                container.innerHTML = `
                    <div class="prescription-results">
                        <div class="text-center mb-8">
                            <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-green-500 to-blue-500 rounded-full mb-4">
                                <i class="fas fa-heart text-white text-3xl"></i>
                            </div>
                            <h2 class="text-3xl font-bold text-gray-800 mb-2">Your Personal Recovery Prescription</h2>
                            <p class="text-gray-600">Created by AI Coach Sarah based on your unique responses</p>
                        </div>
                        
                        <div class="bg-white border-2 border-green-200 rounded-lg p-8 mb-8 shadow-lg">
                            <div class="prescription-content prose max-w-none">
                                ${this.formatPrescription(prescription)}
                            </div>
                        </div>
                        
                        <div class="flex flex-wrap gap-4 justify-center">
                            <button onclick="AIAssessment.downloadPrescription()" class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                <i class="fas fa-download mr-2"></i>Download Prescription
                            </button>
                            <button onclick="AIAssessment.shareWithCoach()" class="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                                <i class="fas fa-share mr-2"></i>Share with Coach
                            </button>
                            <button onclick="AIAssessment.goToDashboard()" class="px-6 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors">
                                <i class="fas fa-chart-line mr-2"></i>View Dashboard
                            </button>
                        </div>
                    </div>
                `;
            },

            // Format prescription for display
            formatPrescription: function(text) {
                // Convert markdown-like formatting to HTML
                return text
                    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')
                    .replace(/\\n\\n/g, '</p><p>')
                    .replace(/\\n/g, '<br>')
                    .replace(/^/, '<p>')
                    .replace(/$/, '</p>');
            },

            // Save to dashboard
            saveToDashboard: function(prescription) {
                const assessmentData = {
                    timestamp: new Date().toISOString(),
                    responses: this.responses,
                    followUpQuestions: this.followUpQuestions,
                    prescription: prescription,
                    crisisScore: this.calculateCrisisScore()
                };
                
                localStorage.setItem('assessment_results', JSON.stringify(assessmentData));
                localStorage.setItem('prescription', prescription);
                console.log('üíæ Assessment data saved to dashboard');
            },

            // Fallback prescription if AI fails
            showFallbackPrescription: function() {
                const fallback = `Thank you for completing your assessment. Based on your responses, I can see you're on a journey of healing and growth.

**Your Next Steps:**
1. **Daily Self-Care**: Focus on small, consistent actions that nurture your wellbeing
2. **Professional Support**: Consider connecting with a mental health professional who understands trauma
3. **Community**: You're not alone - support is available when you need it

**EMDR Techniques**: Use the EMDR tools in this platform for self-soothing and processing
**Crisis Support**: Available 24/7 - Samaritans: 116 123 (UK), Crisis Lifeline: 988 (US)

Remember: Healing is possible, and you deserve support on this journey.`;

                this.showPrescriptionResults(fallback);
            },

            // Action handlers
            downloadPrescription: function() {
                const prescription = localStorage.getItem('prescription') || 'Prescription not available';
                const blob = new Blob([prescription], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `recovery-prescription-${new Date().toISOString().split('T')[0]}.txt`;
                a.click();
                URL.revokeObjectURL(url);
            },

            goToDashboard: function() {
                // Navigate to dashboard
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.add('hidden');
                });
                document.getElementById('dashboard').classList.remove('hidden');
            }
        };

        // Initialize assessment when page loads  
        document.addEventListener('DOMContentLoaded', () => {
            // Give main app.js time to load first
            setTimeout(() => {
                AIAssessment.init();
            }, 500);
        });

        // Debug: Check if main app functions exist
        setTimeout(() => {
            console.log('üîç Debug - Main app functions available:');
            console.log('- app.buyEnterpriseNow:', typeof window.app?.buyEnterpriseNow);
            console.log('- app.selectPlan:', typeof window.app?.selectPlan);
            console.log('- Main app object:', window.app);
        }, 1000);

        // Emergency fallback functions for missing app methods
        window.ensureAppFunctions = function() {
            if (!window.app) {
                window.app = {};
            }
            
            if (!window.app.buyEnterpriseNow) {
                window.app.buyEnterpriseNow = function() {
                    console.log('üöß buyEnterpriseNow called - redirecting to enterprise contact');
                    alert('Enterprise purchasing temporarily unavailable. Please contact support for enterprise solutions.');
                };
            }
            
            if (!window.app.selectPlan) {
                window.app.selectPlan = function(planType) {
                    console.log('üöß selectPlan called with:', planType);
                    alert('Plan selection temporarily unavailable. Please refresh the page and try again.');
                };
            }
        };

        // Ensure functions are available
        setTimeout(() => {
            window.ensureAppFunctions();
        }, 100);

        console.log('‚úÖ Complete AI Assessment System Loaded - Ready for intelligent analysis!');
    </script>
</body>
</html>